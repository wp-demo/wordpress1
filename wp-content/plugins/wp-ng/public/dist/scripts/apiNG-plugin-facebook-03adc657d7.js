"use strict";angular.module("jtt_aping_facebook",["jtt_facebook"]).directive("apingFacebook",["apingFacebookHelper","apingUtilityHelper","facebookFactory","facebookPagesImages",function(r,n,s,c){return{require:"?aping",restrict:"A",replace:"false",link:function(t,e,i,a){var o=a.getAppSettings();n.parseJsonFromAttributes(i.apingFacebook,r.getThisPlatformString(),o).forEach(function(t){var e={model:o.model,showAvatar:t.showAvatar||!1};void 0!==o.getNativeData?e.getNativeData=o.getNativeData:e.getNativeData=!1;var i={page:t.page,access_token:n.getApiCredentials(r.getThisPlatformString(),"access_token")};if(t.accessToken&&(i.access_token=t.accessToken),void 0!==t.items?i.limit=t.items:i.limit=o.items,0===i.limit||"0"===i.limit)return!1;if((i.limit<0||isNaN(i.limit))&&(i.limit=void 0),100<i.limit&&(i.limit=100),t.page)switch(o.model){case"social":!0===e.showAvatar||"true"===e.showAvatar?s.getPageById({page:i.page,access_token:i.access_token}).then(function(t){t&&t.data&&t.data.id&&t.data.cover&&t.data.cover.source&&(c[t.data.id]=t.data.cover.source),s.getPostsFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))})}):s.getPostsFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))});break;case"video":!0===e.showAvatar||"true"===e.showAvatar?s.getPageById({page:i.page,access_token:i.access_token}).then(function(t){t&&t.data&&t.data.id&&t.data.cover&&t.data.cover.source&&(c[t.data.id]=t.data.cover.source),s.getVideosFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))})}):s.getVideosFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))});break;case"image":s.getPhotosFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))});break;case"event":!0===e.showAvatar||"true"===e.showAvatar?s.getPageById({page:i.page,access_token:i.access_token}).then(function(t){t&&t.data&&t.data.id&&t.data.cover&&t.data.cover.source&&(c[t.data.id]=t.data.cover.source),s.getEventsFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))})}):s.getEventsFromPageById(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,o))})}})}}}]),angular.module("jtt_aping_facebook").service("apingFacebookHelper",["apingModels","apingTimeHelper","apingUtilityHelper","facebookPagesImages",function(r,n,t,s){this.getThisPlatformString=function(){return"facebook"},this.getThisPlatformLink=function(){return"https://facebook.com/"},this.getRatioFromFormatObject=function(t){var i={width:void 0,height:void 0};if(void 0!==t&&t.constructor===Array)return angular.forEach(t,function(t,e){void 0!==t.filter&&"native"===t.filter&&(void 0!==t.width&&(i.width=t.width),void 0!==t.height&&(i.height=t.height))}),i},this.getDifference=function(t,e){return e<t?t-e:e-t},this.getImagesFromArray=function(t,i){angular.isUndefined(i)&&(i="source");var a=this,o={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return t.constructor===Array&&angular.forEach(t,function(t,e){angular.isDefined(t[i])&&(angular.isUndefined(o.thumb_url)?(o.thumb_url=t[i],o.thumb_width=t.width,o.thumb_height=t.height):a.getDifference(o.thumb_width,200)>a.getDifference(t.width,200)&&200<=t.width&&(o.thumb_url=t[i],o.thumb_width=t.width,o.thumb_height=t.height),angular.isUndefined(o.img_url)?(o.img_url=t[i],o.img_width=t.width,o.img_height=t.height):a.getDifference(o.img_width,700)>a.getDifference(t.width,700)&&(o.img_url=t[i],o.img_width=t.width,o.img_height=t.height),angular.isUndefined(o.native_url)?(o.native_url=t[i],o.native_width=t.width,o.native_height=t.height):t.width>o.native_width&&(o.native_url=t[i],o.native_width=t.width,o.native_height=t.height))}),o},this.getObjectByJsonData=function(t,a){var o=[];if(t){var r=this;t.data&&t.data.data&&angular.forEach(t.data.data,function(t,e){var i;(i=!0===a.getNativeData||"true"===a.getNativeData?t:r.getItemByJsonData(t,a))&&o.push(i)})}return o},this.getItemByJsonData=function(t,e){var i={};if(t&&e.model)switch(e.model){case"social":i=this.getSocialItemByJsonData(t,e);break;case"video":i=this.getVideoItemByJsonData(t,e);break;case"image":i=this.getImageItemByJsonData(t,e);break;case"event":i=this.getEventItemByJsonData(t,e);break;default:return!1}return i},this.getSocialItemByJsonData=function(t,e){var i=r.getNew("social",this.getThisPlatformString());switch(angular.extend(i,{blog_name:t.from.name,blog_id:t.from.id,blog_link:this.getThisPlatformLink()+t.from.id+"/",intern_type:t.type,intern_id:t.id,thumb_url:t.picture,img_url:t.full_picture,native_url:t.full_picture,timestamp:n.getTimestampFromDateString(t.created_time,1e3,36e5)}),i.date_time=new Date(i.timestamp),t.type){case"photo":i.type="image",i.post_url=t.link,i.text=t.message;break;case"status":i.type="post";break;case"link":i.type="link",i.post_url=this.getThisPlatformLink()+t.id+"/",i.content_url=t.link,i.caption=t.name;break;case"video":i.type="video",t.name&&(i.caption=t.name);break;case"event":i.type="event",i.text=t.description,i.caption=t.caption||t.name||void 0}return i.text||(i.text=t.message),i.text||(i.text=t.name),i.post_url||(t.id?i.post_url=this.getThisPlatformLink()+t.id+"/":i.post_url=t.link),!0!==e.showAvatar&&"true"!==e.showAvatar||i.img_url||s[t.from.id]&&(i.img_url=s[t.from.id]),i},this.getVideoItemByJsonData=function(t,e){var i=r.getNew("video",this.getThisPlatformString());if(angular.extend(i,{blog_name:t.from.name,blog_id:t.from.id,blog_link:this.getThisPlatformLink()+t.from.id+"/",intern_id:t.id,post_url:t.permalink_url,timestamp:n.getTimestampFromDateString(t.created_time,1e3,36e5),text:t.description,markup:t.embed_html||void 0,source:t.source||void 0}),i.date_time=new Date(i.timestamp),void 0!==t.length&&(i.length=t.length),void 0!==t.format&&0<t.format.length){var a=this.getImagesFromArray(t.format,"picture");a.thumb_width=void 0,a.thumb_height=void 0,a.img_width=void 0,a.img_height=void 0,a.native_width=void 0,a.native_height=void 0,angular.extend(i,a);var o=this.getRatioFromFormatObject(t.format);void 0!==o.width&&(i.width=o.width),void 0!==o.height&&(i.height=o.height)}return!0!==e.showAvatar&&"true"!==e.showAvatar||i.img_url||s[t.from.id]&&(i.img_url=s[t.from.id]),i},this.getImageItemByJsonData=function(t,e){var i=r.getNew("image",this.getThisPlatformString());if(angular.extend(i,{blog_name:t.from.name,blog_id:t.from.id,blog_link:this.getThisPlatformLink()+t.from.id+"/",intern_id:t.id,post_url:t.link,timestamp:n.getTimestampFromDateString(t.created_time,1e3,36e5),text:t.name||void 0,source:t.images||void 0}),i.date_time=new Date(i.timestamp),0<t.images.length){var a=this.getImagesFromArray(t.images,"source");angular.extend(i,a)}return i},this.getEventItemByJsonData=function(t,e){var i=r.getNew("event",this.getThisPlatformString());return angular.extend(i,{artist_name:t.owner.name,artist_id:t.owner.id,artist_link:this.getThisPlatformLink()+t.owner.id+"/",intern_id:t.id,event_url:this.getThisPlatformLink()+t.owner.id+"_"+t.id+"/",ticket_url:t.ticket_uri||void 0,start_timestamp:n.getTimestampFromDateString(t.start_time,1e3,36e5),end_timestamp:t.end_time?n.getTimestampFromDateString(t.end_time,1e3,36e5):void 0,caption:t.name||void 0,text:t.description||void 0,img_url:t.cover?t.cover.source:void 0}),i.start_timestamp&&(i.start_date_time=new Date(i.start_timestamp)),i.end_timestamp&&(i.end_date_time=new Date(i.end_timestamp)),t.place&&(i.place_name=t.place.name||void 0,t.place.location&&(i.city=t.place.location.city||void 0,i.country=t.place.location.country||void 0,i.latitude=t.place.location.latitude||void 0,i.longitude=t.place.location.longitude||void 0,i.street=t.place.location.street||void 0,i.zip=t.place.location.zip||void 0)),!0!==e.showAvatar&&"true"!==e.showAvatar||i.img_url||s[t.from.id]&&(i.img_url=s[t.from.id]),i}}]),angular.module("jtt_aping_facebook").config(["$provide",function(t){t.value("facebookPagesImages",{})}]),angular.module("jtt_facebook",[]).factory("facebookFactory",["$http","facebookSearchDataService",function(i,a){var t={getPostsFromPageById:function(t){var e=a.getNew("postsFromPageById",t);return i({method:"GET",url:e.url,params:e.object})},getPhotosFromPageById:function(t){var e=a.getNew("photosFromPageById",t);return i({method:"GET",url:e.url,params:e.object})},getVideosFromPageById:function(t){var e=a.getNew("videosFromPageById",t);return i({method:"GET",url:e.url,params:e.object})},getEventsFromPageById:function(t){var e=a.getNew("eventsFromPageById",t);return i({method:"GET",url:e.url,params:e.object})},getPageById:function(t){var e=a.getNew("pageById",t);return i({method:"GET",url:e.url,params:e.object})}};return t}]).service("facebookSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://graph.facebook.com/"+(angular.isDefined(t)&&angular.isDefined(t.version)?t.version+"/":"v2.5/")},this.fillDataInObjectByList=function(i,a,t){return angular.forEach(t,function(t,e){angular.isDefined(a[t])&&(i.object[t]=a[t])}),i},this.getNew=function(t,e){var i={object:{access_token:e.access_token||void 0},url:""};switch(angular.isDefined(e.limit)&&(i.object.limit=e.limit),t){case"postsFromPageById":i.object.fields="id,message,story,created_time,full_picture,from,link,description,type,shares,source,picture,object_id",(i=this.fillDataInObjectByList(i,e,["__paging_token","until","since","__previous"])).url=this.getApiBaseUrl()+e.page+"/posts?";break;case"photosFromPageById":i.object.fields="id,created_time,from,link,picture,album,name,images,width,height",(i=this.fillDataInObjectByList(i,e,["before","after"])).url=this.getApiBaseUrl()+e.page+"/photos?";break;case"videosFromPageById":i.object.fields="id,created_time,from,description,source,picture,format,title,embed_html,permalink_url,length",(i=this.fillDataInObjectByList(i,e,["before","after"])).url=this.getApiBaseUrl()+e.page+"/videos?";break;case"eventsFromPageById":i.object.fields="id,owner,description,picture{url},end_time,name,cover,category,place,start_time,ticket_uri",(i=this.fillDataInObjectByList(i,e,["before","after"])).url=this.getApiBaseUrl()+e.page+"/events?";break;case"pageById":i.object.fields="cover,link,picture{url},username,name",i.object.limit=void 0,i.url=this.getApiBaseUrl()+e.page+"/"}return i}});