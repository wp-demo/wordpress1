angular.module("oi.select",[]),angular.module("oi.select").provider("oiSelect",function(){return{options:{debounce:500,searchFilter:"oiSelectCloseIcon",dropdownFilter:"oiSelectHighlight",listFilter:"oiSelectAscSort",groupFilter:"oiSelectGroup",editItem:!1,newItem:!1,closeList:!0,saveTrigger:"enter tab blur",minlength:0},version:{full:"0.2.21",major:0,minor:2,dot:21},$get:function(){return{options:this.options,version:this.version}}}}).factory("oiSelectEscape",function(){var t=/[-\/\\^$*+?.()|[\]{}]/g;return function(e){return String(e).replace(t,"\\$&")}}).factory("oiSelectEditItem",function(){return function(e,t,n,o){return o?"":n(e)}}).factory("oiUtils",["$document","$timeout",function(u,c){function d(e,t,n){for(var o=t;o&&o.ownerDocument&&11!==o.nodeType;){if(n){if(o===e)return!1;if(0<=o.className.indexOf(n))return!0}else if(o===e)return!0;o=o.parentNode}return!1}function a(e){var t,n,o,r=e.getBoundingClientRect(),i=e&&e.ownerDocument;if(i)return t=i.documentElement,n=null!=(o=i)&&o===o.window?o:9===o.nodeType&&o.defaultView,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}}var p=new RegExp("^("+/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source+")(?!px)[a-z%]+$","i");return{contains:d,bindFocusBlur:function(o,r){function i(e){return e&&"INPUT"!==e.target.nodeName?void 0:(a=!1,l?void(a=!0):void c(function(){o.triggerHandler("blur")}))}function e(){s||(s=!0,c(function(){o.triggerHandler("focus")}))}function t(){l=!0}function n(e){l=!1;var t=e.target,n=d(o[0],t);a&&!n&&i(),n&&"INPUT"!==t.nodeName&&c(function(){r[0].focus()}),!n&&s&&(s=!1)}var s,l,a;return u[0].addEventListener("click",n,!0),o[0].addEventListener("mousedown",t,!0),o[0].addEventListener("blur",i,!0),r.on("focus",e),function(){u[0].removeEventListener("click",n,!0),o[0].removeEventListener("mousedown",t,!0),o[0].removeEventListener("blur",i,!0),r.off("focus",e)}},scrollActiveOption:function(e,t){var n,o,r,i,s,l;t&&(o=e.offsetHeight,r=function(e,t,n){var o="width"===t?e.offsetWidth:e.offsetHeight,r=window.getComputedStyle(e,null);if(o<=0||null==o){if(((o=r[t])<0||null==o)&&(o=e.style[t]),p.test(o))return o;o=parseFloat(o)||0}return o+function(e,t,n,o,r){function i(e){return parseFloat(r[e])}for(var s=n===(o?"border":"content")?4:"width"===t?1:0,l=0,a=["Top","Right","Bottom","Left"];s<4;s+=2)"margin"===n&&(l+=i(n+a[s])),o?("content"===n&&(l-=i("padding"+a[s])),"margin"!==n&&(l-=i("border"+a[s]+"Width"))):(l+=i("padding"+a[s]),"padding"!==n&&(l+=i("border"+a[s]+"Width")));return l}(0,t,n||"content",!0,r)}(t,"height","margin"),i=e.scrollTop||0,l=(s=n=a(t).top-a(e).top+i)-o+r,o+i<n+r?e.scrollTop=l:n<i&&(e.scrollTop=s))},groupsIsEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].length)return!1;return!0},getValue:function(e,r,t,n){var o={};return e.split(".").reduce(function(e,t,n,o){return e[t]=n<o.length-1?{}:r},o),n(t,o)},intersection:function(e,t,n,o,r){var i,s,l,a,u,c=r?[].concat(e):[];for(i=0,l=e.length;i<e.length;i++)for(a=n?n(e[i]):e[i],s=0;s<t.length;s++)if(u=o?o(t[s]):t[s],angular.equals(a,u,e,t,i,s)){r?c.splice(i+c.length-l,1):c.push(t[s]);break}return c}}}]),angular.module("oi.select").directive("oiSelect",["$document","$q","$timeout","$parse","$interpolate","$injector","$filter","$animate","oiUtils","oiSelect",function(e,fe,ge,me,d,he,ve,$e,we,be){var p=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,f=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"src/template.html",require:"ngModel",scope:{},compile:function(e,t){var n=t.oiOptions,Q=n?n.match(p):["","i","","","","i","","",""];if(!Q)throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var o=/ as /.test(Q[0])&&Q[1],r=Q[2]||Q[1],U=Q[5]||Q[7],R=Q[6],i=Q[3]||"",s=Q[4]||"",l=Q[9]||r,a=Q[8].match(f),W=U,j=R;R&&(o=(U="i")+"."+(o||W),r=U+"."+r,R=l=U+"."+R,i=i?U+"."+i:void 0,s=s?U+"."+s:void 0);var B,G,z,X,Y,J,K,Z,ee=a[1],u=ee+(a[3]||""),c=ee+(a[2]||""),te=o&&me(o),ne=me(r),oe=me(i),re=me(s),ie=me(u),se=me(c),le=me(l),ae=d(t.multiplePlaceholder||""),ue=d(t.listPlaceholder||""),ce=d(t.placeholder||""),de=me(t.oiSelectOptions),pe=angular.version.major<=1&&angular.version.minor<=3;return function(c,d,i,s){function l(){C&&d.removeClass("cleanMode"),C=!1}function a(e,t){t=t||150,d.addClass(e),ge(function(){d.removeClass(e)},t)}function n(){c.listItemHide=!0,c.inputHide=!1}function u(){var e=$(s.$modelValue);c.listItemHide=!e,c.inputHide=e}function e(e){c.query.length<F.minlength||we.contains(d[0],e.target,"disabled")||c.output.length>=K&&we.contains(d[0],e.target,"select-dropdown")||(c.inputHide&&c.removeItem(0),!c.isOpen||!F.closeList||"INPUT"===e.target.nodeName&&c.query.length?w(c.query):(b({query:F.editItem&&!C}),c.$evalAsync()))}function o(e,t){t||(t=e,e=c.query);var n=F.saveTrigger.split(" ").indexOf(t)+1,o=F.newItem&&e,r="blur"!==t?c.order[c.selectorPosition]:null;return n&&(o||r&&!m(r))?(c.showLoader=!0,fe.when(r||Z(c.$parent,{$query:e})).then(function(e){if(void 0===e)return fe.reject();c.addItem(e);var t=c.order.length-1;c.selectorPosition===t&&y(k,0),F.newItemFn&&!r||ge(angular.noop),b()}).catch(function(){a("invalid-item"),c.showLoader=!1}),!0):void 0}function p(e){return we.getValue(U,e,c.$parent,le)}function f(e){return we.getValue(U,e,c.$parent,te)}function g(e){return we.getValue(U,e,c.$parent,ne)}function m(e){return c.isEmptyList||we.getValue(U,e,c.$parent,re)}function h(e){return we.getValue(U,e,c.$parent,oe)||""}function v(e){return(e=e instanceof Array?e:e?[e]:[]).filter(function(e){return void 0!==e&&(e instanceof Array&&e.length||te||g(e))})}function $(e){return!!v(e).length}function w(a,u){return c.isEmptyList=!1,z&&q&&ge.cancel(z),z=ge(function(){var e=se(c.$parent,{$query:a,$selectedAs:u})||"";return c.selectorPosition="prompt"!==F.newItem&&0,a||u||(c.oldQuery=null),(e.$promise&&!e.$resolved||angular.isFunction(e.then))&&(q=F.debounce),c.showLoader=!0,fe.when(e.$promise||e).then(function(e){if(c.groups={},e&&R){var o=[];angular.forEach(e,function(e,t){if("$"!==t.toString().charAt(0)){var n={};n[j]=t,n[W]=e,o.push(n)}}),e=o}if(e&&!u){var t=J?c.output:[],n=D(e,a,g,_(c.$parent),d),r=we.intersection(n,t,p,p,!0),i=(l=r,we.getValue(ee,l,c.$parent,ie));if(!i.length&&(c.isEmptyList=!0,E)){var s={};ne.assign(s,E),i=[s[U]]}c.groups=function(e){for(var t,n,o={"":[]},r=0;r<e.length;r++)t=h(e[r]),(n=o[t])||(n=o[t]=[]),n.push(e[r]);return o}(i)}var l;return function(){var e,t,n,o=[],r=0;for(t in c.order=[],c.groupPos={},c.groups)c.groups.hasOwnProperty(t)&&"$"!=t.charAt(0)&&o.push(t);for(pe&&o.sort(),e=0;e<o.length;e++)t=o[e],n=c.groups[t],c.order=c.order.concat(n),c.groupPos[t]=r,r+=n.length}(),e}).finally(function(){c.showLoader=!1,F.closeList&&!F.cleanModel&&ge(function(){y(k,0)})})},q)}function b(e){e=e||{},c.oldQuery=null,c.backspaceFocus=!1,c.groups={},c.order=[],c.showLoader=!1,c.isOpen=!1,q=0,e.query||(c.query=""),z&&ge.cancel(z)}function y(e,t){c.selectorPosition=t,we.scrollActiveOption(e[0],e.find("li")[t])}s.$isEmpty=function(e){return!$(e)};var L=d.find("input"),k=angular.element(d[0].querySelector(".select-dropdown")),S=ce(c),I=ae(c),E=ue(c),t=de(c.$parent)||{},F=angular.extend({cleanModel:"prompt"===t.newItem},be.options,t),r=F.editItem,C="correct"===r,q=0;(!0===r||"correct"===r)&&(r="oiSelectEditItem");var V=r?he.get(r):angular.noop,P=me(F.removeItemFn);Q=F.searchFilter.split(":");var x=ve(Q[0]),H=me(Q[1]);Q=F.dropdownFilter.split(":");var O=ve(Q[0]),A=me(Q[1]);Q=F.listFilter.split(":");var D=ve(Q[0]),_=me(Q[1]);Q=F.groupFilter.split(":");var T=ve(Q[0]),N=me(Q[1]);Z=F.newItemFn?me(F.newItemFn):function(e,t){return(de(t)||{}).newItemModel||t.$query},!F.cleanModel||r&&!C||d.addClass("cleanMode");var M=we.bindFocusBlur(d,L);angular.isDefined(i.autofocus)&&ge(function(){L[0].focus()}),angular.isDefined(i.readonly)&&L.attr("readonly",!0),angular.isDefined(i.tabindex)&&(L.attr("tabindex",i.tabindex),d[0].removeAttribute("tabindex")),F.maxlength&&L.attr("maxlength",F.maxlength),i.$observe("disabled",function(e){L.prop("disabled",e),J&&s.$modelValue&&s.$modelValue.length&&(c.inputHide=e)}),c.$on("$destroy",M),c.$parent.$watch(i.multipleLimit,function(e){K=Number(e)||1/0}),c.$parent.$watch(i.multiple,function(e){J=void 0===e?angular.isDefined(i.multiple):e,d[J?"addClass":"removeClass"]("multiple")}),c.$parent.$watch(i.ngModel,function(e,t){var n,o=v(e),r=fe.when(o);n=J&&$(s.$modelValue)?I:S,L.attr("placeholder",n),$(t)&&e!==t&&l(),J||u(),te&&$(e)&&(r=w(null,e).then(function(e){return we.intersection(o,e,null,f)}),z=null),J&&i.disabled&&!$(e)&&(c.inputHide=!1),r.then(function(e){(c.output=e).length!==o.length&&c.removeItem(e.length)})}),c.$watch("query",function(e,t){o(e.slice(0,-1),e.slice(-1))||String(e).length<F.minlength||(e===t||c.oldQuery&&!e||G||(k[0].scrollTop=0,e?(w(e),c.oldQuery=null):J&&(b(),G=!0)),G=!1)}),c.$watch("groups",function(e){we.groupsIsEmpty(e)?c.isOpen=!1:c.isOpen||i.disabled||(c.isOpen=!0,c.isFocused=!0)}),c.$watch("isFocused",function(e){$e[e?"addClass":"removeClass"](d,"focused",!pe&&{tempClasses:"focused-animate"})}),c.$watch("isOpen",function(e){$e[e?"addClass":"removeClass"](d,"open",!pe&&{tempClasses:"open-animate"})}),c.$watch("isEmptyList",function(e){$e[e?"addClass":"removeClass"](d,"emptyList",!pe&&{tempClasses:"emptyList-animate"})}),c.$watch("showLoader",function(e){$e[e?"addClass":"removeClass"](d,"loading",!pe&&{tempClasses:"loading-animate"})}),c.addItem=function(e){if(X=c.query,!J||!we.intersection(c.output,[e],p,p).length){if(c.output.length>=K)return void a("limited");var t=c.groups[h(e)]=c.groups[h(e)]||[],n=te?f(e):e;t.splice(t.indexOf(e),1),J?s.$setViewValue(angular.isArray(s.$modelValue)?s.$modelValue.concat(n):[n]):(s.$setViewValue(n),u()),we.groupsIsEmpty(c.groups)&&(c.groups={}),J||F.closeList||b({query:!0}),l(),c.oldQuery=c.oldQuery||c.query,c.query="",c.backspaceFocus=!1}},c.removeItem=function(e){i.disabled||J&&e<0||(Y=J?s.$modelValue[e]:s.$modelValue,fe.when(P(c.$parent,{$item:Y})).then(function(){(J||c.inputHide)&&(J?(s.$modelValue.splice(e,1),s.$setViewValue([].concat(s.$modelValue))):(n(),F.cleanModel&&s.$setViewValue(void 0)),(J||!c.backspaceFocus)&&(c.query=V(Y,X,g,C,d)||""),J&&F.closeList&&b({query:!0}))}))},c.setSelection=function(e){B||c.selectorPosition===e?B=!1:y(k,e)},c.keyUp=function(e){switch(e.keyCode){case 8:c.query.length||J&&c.output.length||b()}},c.keyDown=function(e){var t=c.order.length-1;switch(e.keyCode){case 38:c.selectorPosition=angular.isNumber(c.selectorPosition)?c.selectorPosition:0,y(k,0===c.selectorPosition?t:c.selectorPosition-1),B=!0;break;case 40:c.selectorPosition=angular.isNumber(c.selectorPosition)?c.selectorPosition:-1,y(k,c.selectorPosition===t?0:c.selectorPosition+1),B=!0,c.query.length||c.isOpen||w(),c.inputHide&&n();break;case 37:case 39:break;case 9:o("tab");break;case 13:o("enter"),e.preventDefault();break;case 32:o("space");break;case 27:J||(u(),F.cleanModel&&s.$setViewValue(Y)),b();break;case 8:if(!c.query.length){if((!J||r)&&(c.backspaceFocus=!0),c.backspaceFocus&&c.output&&(!J||c.output.length)){c.removeItem(c.output.length-1),r&&e.preventDefault();break}c.backspaceFocus=!c.backspaceFocus;break}default:return c.inputHide&&n(),c.backspaceFocus=!1}},c.getSearchLabel=function(e){var t=g(e);return x(t,c.oldQuery||c.query,e,H(c.$parent),d)},c.getDropdownLabel=function(e){var t=g(e);return O(t,c.oldQuery||c.query,e,A(c.$parent),d)},c.getGroupLabel=function(e,t){return T(e,c.oldQuery||c.query,t,N(c.$parent),d)},c.getDisableWhen=m,b(),d[0].addEventListener("click",e,!0),c.$on("$destroy",function(){d[0].removeEventListener("click",e,!0)}),d.on("focus",function(){c.isFocused||(c.isFocused=!0,i.disabled||(c.backspaceFocus=!1))}),d.on("blur",function(){c.isFocused=!1,J||u(),o("blur")||b(),c.$evalAsync()})}}}}]),angular.module("oi.select").filter("oiSelectGroup",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("oiSelectCloseIcon",["$sce",function(t){return function(e){return t.trustAsHtml(e+'<span class="close select-search-list-item_selection-remove">×</span>')}}]).filter("oiSelectHighlight",["$sce","oiSelectEscape",function(o,r){return function(e,t){var n;return n=0<t.length||angular.isNumber(t)?(e=e.toString(),t=r(t),e.replace(new RegExp(t,"gi"),"<strong>$&</strong>")):e,o.trustAsHtml(n)}}]).filter("oiSelectAscSort",["oiSelectEscape",function(p){return function(e,t,n,o){var r,i,s,l,a=[],u=[],c=[],d=[];if(t){for(t=p(t).toLocaleLowerCase(),r=0,s=!1;r<e.length;r++){if(!(s=n(e[r]).toLocaleLowerCase().match(new RegExp(t)))&&o&&(o.length||o.fields))for(i=0;i<o.length&&!s;i++)s=String(e[r][o[i]]).toLocaleLowerCase().match(new RegExp(t));s&&a.push(e[r])}for(r=0;r<a.length;r++)n(a[r]).toLocaleLowerCase().match(new RegExp("^"+t))?u.push(a[r]):c.push(a[r]);if(l=u.concat(c),o&&(!0===o||o.all)){e:for(r=0;r<e.length;r++){for(i=0;i<l.length;i++)if(e[r]===l[i])continue e;d.push(e[r])}l=l.concat(d)}}else l=[].concat(e);return l}}]).filter("none",function(){return function(e){return e}}),angular.module("oi.select").run(["$templateCache",function(e){e.put("src/template.html",'<div class=select-search><ul class=select-search-list><li class="btn btn-default btn-xs select-search-list-item select-search-list-item_selection" ng-hide=listItemHide ng-repeat="item in output track by $index" ng-class="{focused: backspaceFocus && $last}" ng-click=removeItem($index) ng-bind-html=getSearchLabel(item)></li><li class="select-search-list-item select-search-list-item_input" ng-class="{\'select-search-list-item_hide\': inputHide}"><input autocomplete=off ng-model=query ng-keyup=keyUp($event) ng-keydown=keyDown($event)></li><li class="select-search-list-item select-search-list-item_loader" ng-show=showLoader></li></ul></div><div class=select-dropdown ng-show=isOpen><ul ng-if=isOpen class=select-dropdown-optgroup ng-repeat="(group, options) in groups"><div class=select-dropdown-optgroup-header ng-if="group && options.length" ng-bind-html="getGroupLabel(group, options)"></div><li class=select-dropdown-optgroup-option ng-init="isDisabled = getDisableWhen(option)" ng-repeat="option in options" ng-class="{\'active\': selectorPosition === groupPos[group] + $index, \'disabled\': isDisabled, \'ungroup\': !group}" ng-click="isDisabled || addItem(option)" ng-mouseenter="setSelection(groupPos[group] + $index)" ng-bind-html=getDropdownLabel(option)></li></ul></div>')}]);