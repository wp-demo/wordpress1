"use strict";angular.module("jtt_aping_instagram",["jtt_instagram"]).directive("apingInstagram",["instagramFactory","apingInstagramHelper","apingUtilityHelper",function(n,r,o){return{require:"?aping",restrict:"A",replace:"false",link:function(t,e,a,i){var s=i.getAppSettings();o.parseJsonFromAttributes(a.apingInstagram,r.getThisPlatformString(),s).forEach(function(t){var e={model:s.model};void 0!==s.getNativeData?e.getNativeData=s.getNativeData:e.getNativeData=!1;var a={access_token:o.getApiCredentials(r.getThisPlatformString(),"access_token")};if(t.accessToken&&(a.access_token=t.accessToken),void 0!==t.items?a.count=t.items:a.count=s.items,0===a.count||"0"===a.count)return!1;(a.count<0||isNaN(a.count))&&(a.count=void 0),33<a.count&&(a.count=33),t.userId?(a.userId=t.userId,n.getMediaFromUserById(a).then(function(t){i.concatToResults(r.getObjectByJsonData(t,e))})):t.tag?(a.tag=t.tag,n.getMediaByTag(a).then(function(t){i.concatToResults(r.getObjectByJsonData(t,e))})):t.locationId?(a.locationId=t.locationId,n.getMediaFromLocationById(a).then(function(t){i.concatToResults(r.getObjectByJsonData(t,e))})):t.lat&&t.lng&&(a.lat=t.lat,a.lng=t.lng,t.distance&&(a.distance=t.distance),n.getMediaByCoordinates(a).then(function(t){i.concatToResults(r.getObjectByJsonData(t,e))}))})}}}]),angular.module("jtt_aping_instagram").service("apingInstagramHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,t,e){this.getThisPlatformString=function(){return"instagram"},this.getThisPlatformLink=function(){return"https://instagram.com/"},this.replaceHashtagWithoutSpaces=function(t){return t&&"string"==typeof t&&(t=(t=t.replace(/#/g," #")).replace(/  #/g," #")),t},this.getObjectByJsonData=function(t,i){var s=[];if(t){var n=this;t.data&&t.data.data&&angular.forEach(t.data.data,function(t,e){var a;(a=!0===i.getNativeData||"true"===i.getNativeData?n.getNativeItemByJsonData(t,i.model):n.getItemByJsonData(t,i.model))&&s.push(a)})}return s},this.getItemByJsonData=function(t,e){var a={};if(t&&e)switch(e){case"social":a=this.getSocialItemByJsonData(t);break;case"video":a=this.getVideoItemByJsonData(t);break;case"image":a=this.getImageItemByJsonData(t);break;default:return!1}return a},this.getSocialItemByJsonData=function(t){var e=a.getNew("social",this.getThisPlatformString());return angular.extend(e,{blog_name:t.user.full_name||"@"+t.user.username,blog_id:"@"+t.user.username,blog_link:this.getThisPlatformLink()+t.user.username,intern_type:t.type,timestamp:1e3*parseInt(t.created_time),post_url:t.link,intern_id:t.id,text:t.caption?t.caption.text:void 0,likes:t.likes?t.likes.count:void 0,comments:t.comments?t.likes.comments:void 0,thumb_url:t.images.low_resolution.url,img_url:t.images.standard_resolution.url,native_url:t.images.standard_resolution.url.replace("s640x640/","")}),e.date_time=new Date(e.timestamp),e.text=this.replaceHashtagWithoutSpaces(e.text),"video"==t.type&&(e.type="video",e.source=t.videos),e},this.getVideoItemByJsonData=function(t){if("video"!=t.type)return!1;var e=a.getNew("video",this.getThisPlatformString());return angular.extend(e,{blog_name:t.user.full_name||"@"+t.user.username,blog_id:"@"+t.user.username,blog_link:this.getThisPlatformLink()+t.user.username,intern_type:t.type,timestamp:1e3*parseInt(t.created_time),post_url:t.link,intern_id:t.id,text:t.caption?t.caption.text:void 0,likes:t.likes?t.likes.count:void 0,comments:t.comments?t.likes.comments:void 0,type:"video",source:t.videos.standard_resolution?t.videos.standard_resolution.url:void 0,width:t.videos.standard_resolution?t.videos.standard_resolution.width:void 0,height:t.videos.standard_resolution?t.videos.standard_resolution.height:void 0,thumb_url:t.images.low_resolution.url,img_url:t.images.standard_resolution.url,native_url:t.images.standard_resolution.url.replace("s640x640/","")}),e.date_time=new Date(e.timestamp),e.text=this.replaceHashtagWithoutSpaces(e.text),e},this.getImageItemByJsonData=function(t){if("image"!=t.type)return!1;var e=a.getNew("image",this.getThisPlatformString());return angular.extend(e,{blog_name:t.user.full_name||"@"+t.user.username,blog_id:"@"+t.user.username,blog_link:this.getThisPlatformLink()+t.user.username,intern_type:t.type,timestamp:1e3*parseInt(t.created_time),post_url:t.link,intern_id:t.id,text:t.caption?t.caption.text:void 0,likes:t.likes?t.likes.count:void 0,comments:t.comments?t.likes.comments:void 0,thumb_url:t.images.low_resolution.url,thumb_width:t.images.low_resolution.width,thumb_height:t.images.low_resolution.height,img_url:t.images.standard_resolution.url,img_width:t.images.standard_resolution.width,img_height:t.images.standard_resolution.height,native_url:t.images.standard_resolution.url.replace("s640x640/",""),type:"image"}),e.date_time=new Date(e.timestamp),e.text=this.replaceHashtagWithoutSpaces(e.text),e},this.getNativeItemByJsonData=function(t,e){switch(e){case"image":if("image"!=t.type)return!1;t;break;case"video":if("video"!=t.type)return!1;t}return t}}]),angular.module("jtt_instagram",[]).factory("instagramFactory",["$sce","$http","instagramSearchDataService",function(a,i,s){var t={getUserById:function(t){var e=s.getNew("userById",t);return i.jsonp(a.trustAsResourceUrl(e.url),{method:"GET",params:e.object})},getMediaFromUserById:function(t){var e=s.getNew("mediaFromUserById",t);return i.jsonp(a.trustAsResourceUrl(e.url),{method:"GET",params:e.object})},getMediaByTag:function(t){var e=s.getNew("mediaByTag",t);return i.jsonp(a.trustAsResourceUrl(e.url),{method:"GET",params:e.object})},getMediaFromLocationById:function(t){var e=s.getNew("mediaFromLocationById",t);return i.jsonp(a.trustAsResourceUrl(e.url),{method:"GET",params:e.object})},getMediaByCoordinates:function(t){var e=s.getNew("mediaByCoordinates",t);return i.jsonp(a.trustAsResourceUrl(e.url),{method:"GET",params:e.object})}};return t}]).service("instagramSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://api.instagram.com/v1/"},this.fillDataInObjectByList=function(a,i,t){return angular.forEach(t,function(t,e){angular.isDefined(i[t])&&(a.object[t]=i[t])}),a},this.getNew=function(t,e){var a={object:{access_token:e.access_token,jsonpCallbackParam:"callback"},url:""};switch(angular.isDefined(e.count)&&(a.object.count=e.count),t){case"userById":a.object.count=void 0,a.url=this.getApiBaseUrl()+"users/"+e.userId;break;case"mediaFromUserById":(a=this.fillDataInObjectByList(a,e,["max_id","min_id","min_timestamp","max_timestamp"])).url=this.getApiBaseUrl()+"users/"+e.userId+"/media/recent";break;case"mediaByTag":(a=this.fillDataInObjectByList(a,e,["max_tag_id","min_tag_id","min_timestamp","max_timestamp"])).url=this.getApiBaseUrl()+"tags/"+e.tag+"/media/recent";break;case"mediaFromLocationById":(a=this.fillDataInObjectByList(a,e,["max_id","min_id","min_timestamp","max_timestamp"])).url=this.getApiBaseUrl()+"locations/"+e.locationId+"/media/recent";break;case"mediaByCoordinates":(a=this.fillDataInObjectByList(a,e,["lat","lng","distance","min_timestamp","max_timestamp"])).url=this.getApiBaseUrl()+"media/search"}return a}});