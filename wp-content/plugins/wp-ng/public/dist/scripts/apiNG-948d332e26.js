angular.module("jtt_aping",["jtt_aping_jsonloader","jtt_aping_xml","jtt_aping_ng_array","jtt_aping_local_storage","jtt_aping_json_string"]),angular.module("jtt_aping").config(["$provide",function(e){e.value("apingDefaultSettings",{apingApiKeys:{}})}]).value("apingResults",{}).directive("aping",["apingResults","apingDefaultSettings","apingUtilityHelper","$templateRequest","$compile",function(a,d,n,o,l){return{restrict:"EA",transclude:!0,template:"<ng-transclude></ng-transclude>",scope:{model:"@",getNativeData:"@",items:"@",maxItems:"@",orderBy:"@",orderReverse:"@",templateUrl:"@",payloadJson:"@",removeDoubles:"@",mergeDoubles:"@",idBy:"@",resultProperty:"@",resultName:"@",valueName:"@",protocol:"@"},link:function(t,a,e,r,n){var i=t.templateUrl;function s(e){angular.isDefined(e)&&"$NONE"!==e?o(e).then(function(e){var r=angular.element(e);a.empty().append(r),l(r)(t)}):n(t,function(e,r){a.html(""),a.append(e),l(e)(r)}),t.$broadcast("apiNG.templateRendered")}t.$watch("templateUrl",function(){s(t.templateUrl)}),angular.isUndefined(i)&&angular.isDefined(d.templateUrl)&&s(i=d.templateUrl)},controller:["$scope",function(g){angular.isUndefined(g.resultName)&&(angular.isUndefined(g.resultProperty)?g.resultName="results":g.resultName=g.resultProperty),g[g.resultName]=[],g.payload=g.payloadJson?n.replaceSingleQuotesAndParseJson(g.payloadJson):{},this.getAppSettings=function(){var e,r,t,a,n,i,s,o,l,u;return o=angular.isDefined(g.valueName)?g.valueName:void 0,e=angular.isDefined(g.items)?g.items:angular.isDefined(d.items)?d.items:void 0,r=angular.isDefined(g.maxItems)?g.maxItems:angular.isDefined(d.maxItems)?d.maxItems:void 0,t=angular.isDefined(g.getNativeData)?g.getNativeData:!!angular.isDefined(d.getNativeData)&&d.getNativeData,r=angular.isDefined(g.maxItems)?g.maxItems:angular.isDefined(d.maxItems)?d.maxItems:void 0,n=angular.isDefined(g.orderBy)?g.orderBy:angular.isDefined(d.orderBy)?d.orderBy:void 0,a=angular.isDefined(g.orderReverse)?g.orderReverse:!!angular.isDefined(d.orderReverse)&&d.orderReverse,i=angular.isDefined(g.removeDoubles)?g.removeDoubles:!!angular.isDefined(d.removeDoubles)&&d.removeDoubles,s=angular.isDefined(g.mergeDoubles)?g.mergeDoubles:!!angular.isDefined(d.mergeDoubles)&&d.mergeDoubles,l=angular.isDefined(g.idBy)?g.idBy:angular.isDefined(d.idBy)?d.idBy:void 0,u=angular.isDefined(g.protocol)?g.protocol:angular.isDefined(d.protocol)?d.protocol:void 0,{model:g.model||d.model||"native",getNativeData:t,items:e,maxItems:r,orderBy:n,orderReverse:a,removeDoubles:i,mergeDoubles:s,idBy:l,valueName:o,protocol:u}},this.concatToResults=function(e){angular.isUndefined(g.resultName)&&(angular.isUndefined(g.resultProperty)?g.resultName="results":g.resultName=g.resultProperty);var r=g[g.resultName].concat(e),t=this.getAppSettings();angular.isDefined(t.idBy)&&(r=n.createIdByPropertiesForArray(r,t.idBy),!0!==t.mergeDoubles&&"true"!==t.mergeDoubles||(r=n.mergeDuplicateObjectsFromArray(r,!1===t.orderBy||"false"===t.orderBy||"$NONE"===t.orderBy))),!0!==t.removeDoubles&&"true"!==t.removeDoubles||!0!==t.mergeDoubles&&"true"!==t.mergeDoubles&&(r=n.removeDuplicateObjectsFromArray(r,!1===t.orderBy||"false"===t.orderBy||"$NONE"===t.orderBy,angular.isDefined(t.idBy))),angular.isDefined(t.orderBy)&&!1!==t.orderBy&&"false"!==t.orderBy&&"$NONE"!==t.orderBy&&("$RANDOM"===t.orderBy?r=n.shuffleArray(r):r.sort(n.sortArrayByProperty(t.orderBy))),!0!==t.orderReverse&&"true"!==t.orderReverse||"$RANDOM"===t.orderBy||r.reverse(),-1<t.maxItems&&r.length>t.maxItems&&(r=r.splice(0,t.maxItems)),angular.isDefined(t.valueName)&&(a[t.valueName]=r),g[g.resultName]=r,g.$broadcast("apiNG.resultMerged",{resultName:g.resultName,valueName:g.valueName}),g.$emit("apiNG.resultMerged",{resultName:g.resultName,valueName:g.valueName})},this.apply=function(){g.$apply()}}]}}]),angular.module("jtt_aping").service("apingTimeHelper",function(){this.getTimestampFromDateString=function(e,r,t){if((angular.isUndefined(r)||isNaN(r))&&(r=1),(angular.isUndefined(t)||isNaN(t))&&(t=0),"string"==typeof e){var a=e.split(/[^0-9]/);try{return parseInt(Math.round(new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])/1e3*r)+t,10)}catch(e){return 0}}return 0}}).service("apingUtilityHelper",["apingInputObjects","apingDefaultSettings","$parse",function(i,t,r){this.getApiCredentials=function(e,r){return!(!t.apingApiKeys||!t.apingApiKeys[e])&&t.apingApiKeys[e][Math.floor(Math.random()*t.apingApiKeys[e].length)][r]},this.parseJsonFromAttributes=function(e,r,t){return this.parseRequestsFromAttributes(e,r,t)},this.getDifference=function(e,r){return r<e?e-r:r-e},this.parseRequestsFromAttributes=function(e,t,a){if("string"!=typeof e||!e)return[];var n=[],r=this.replaceSingleQuotesAndParseJson(e);return r.constructor===Array?angular.forEach(r,function(e){e.platform=t,a&&(angular.isUndefined(e.items)&&angular.isDefined(a.items)&&(e.items=a.items),angular.isUndefined(e.model)&&angular.isDefined(a.model)&&(e.model=a.model));var r=i.getNew("request",e);n.push(r)}):n.push(r),n},this.replaceSingleQuotesAndParseJson=function(e){return r(e)()},this.sortArrayByProperty=function(t){var a=1;return"-"===t[0]&&(a=-1,t=t.substr(1)),function(e,r){return(e[t]<r[t]?-1:e[t]>r[t]?1:0)*a}},this.shuffleArray=function(e){for(var r=e.length-1;0<r;r--){var t=Math.floor(Math.random()*(r+1)),a=e[r];e[r]=e[t],e[t]=a}return e},this.removeNullIn=function(e,r){var t=r[e];if(null==t)delete r[e];else if("object"==typeof t)for(var a in t)this.removeNullIn(a,t)},this.removeNull=function(e){for(var r in e)this.removeNullIn(r,e)},this.removeDuplicateObjectsFromArray=function(e,t,a){var n,i=[];n=a?"aping_id":"apingStringified";var r,s="apingTempOrder";if(1===e.length)return e;angular.forEach(e,function(e,r){a||(e.$$hashKey=void 0,e[n]=JSON.stringify(e)),!0===t&&(e[s]=r),i.push(e)}),i.sort(this.sortArrayByProperty(n));var o=[];return angular.forEach(i,function(e){angular.isDefined(r)?angular.isDefined(e[n])&&e[n]!==r&&o.push(e):o.push(e),r=e[n],a||(e[n]=void 0)}),!0===t&&(o.sort(this.sortArrayByProperty(s)),angular.forEach(o,function(e){e[s]=void 0})),o},this.mergeDuplicateObjectsFromArray=function(e,t){var r,a=this,n=[],i="aping_id",s="apingTempOrder";if(1===e.length)return e;angular.forEach(e,function(e,r){!0===t&&(e[s]=r),n.push(e)}),n.sort(this.sortArrayByProperty(i));var o=[];return angular.forEach(n,function(e){a.removeNull(e),angular.isDefined(r)?angular.isDefined(e[i])&&e[i]!==r?o.push(e):o[o.length-1]=angular.merge(o[o.length-1],o[o.length-1],e):o.push(e),r=e[i]}),!0===t&&(o.sort(this.sortArrayByProperty(s)),angular.forEach(o,function(e){e[s]=void 0})),o},this.getTextFromHtml=function(e){return e=(e=e.replace(/&lt;br ?\/\>|&lt;br ?\/&rt;|\<br ?\/\>/g," ")).replace(/<(?:.|\n)*?>/gm,"")},this.getFirstImageFromHtml=function(e){return/<img[^>]+src="([^">]+)/g.exec(e)},this.parseParametersFromUrl=function(e){var r={};return"string"==typeof e&&(r=JSON.parse('{"'+decodeURI(e.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')),r},this.createIdByPropertiesForArray=function(e,r,t){var a=this;return!angular.isUndefined(t)&&angular.isString(t)||(t="aping_id"),angular.isDefined(e)&&angular.isArray(e)&&angular.forEach(e,function(e){e[t]=a.getIdByPropertiesForObject(e,r)}),e},this.getIdByPropertiesForObject=function(r,e){var t=this,a="";if(angular.isDefined(r)&&angular.isObject(r)){var n=[];"["===e.substr(0,1)?n=this.replaceSingleQuotesAndParseJson(e):n.push(e),angular.forEach(n,function(e){a+=t.getValueFromObjectByPropertyString(r,e)})}return a},this.getValueFromObjectByPropertyString=function(e,r,t){var a="";if(angular.isDefined(e)&&angular.isObject(e)){var n=r.split("."),i=e;angular.forEach(n,function(e){angular.isDefined(i[e])&&(i=i[e])}),angular.isDefined(i)&&(a=t&&angular.isObject(i)?JSON.stringify(i):i)}return a}}]),angular.module("jtt_aping").service("apingInputObjects",["apingDefaultSettings",function(a){this.getNew=function(e,r){var t={};switch(e){case"request":t=angular.extend({model:a.model},r)}return t}}]),angular.module("jtt_aping").service("apingModels",[function(){this.getNew=function(e,r){return{platform:r,model:e}}}]),angular.module("jtt_aping_jsonloader",[]).directive("apingJsonloader",["apingUtilityHelper","jsonloaderFactory",function(s,o){return{require:"?aping",restrict:"A",replace:"false",link:function(e,r,t,n){var i=n.getAppSettings();s.parseJsonFromAttributes(t.apingJsonloader,"jsonloader",i).forEach(function(a){if(a.path){var e={path:a.path};if(a.format&&"jsonp"===a.format.toLowerCase()?e.format="jsonp":e.format="json",angular.isUndefined(a.items)&&(a.items=i.items),0===a.items||"0"===a.items)return!1;(a.items<0||isNaN(a.items))&&(a.items=void 0),angular.isDefined(a.orderBy)&&!angular.isString(a.orderBy)&&(a.orderBy=void 0),!angular.isDefined(a.orderReverse)||!0!==a.orderReverse&&"true"!==a.orderReverse||(a.orderReverse=!0),angular.isDefined(a.xAuthToken)&&(e.xAuthToken=a.xAuthToken),o.getJsonData(e).then(function(e){var r=[];if(e.data){var t=e.data;angular.isDefined(a.resultProperty)&&(t=s.getValueFromObjectByPropertyString(t,a.resultProperty,!1)),t.constructor!==Array?r.push(t):(angular.extend(r,t),angular.isDefined(a.orderBy)&&("$RANDOM"===a.orderBy?r=s.shuffleArray(r):r.sort(s.sortArrayByProperty(a.orderBy))),angular.isDefined(a.orderReverse)&&!0===a.orderReverse&&"$RANDOM"!==a.orderBy&&r.reverse(),angular.isUndefined(a.items)?r=t:0<a.items&&r.length>a.items&&(r=r.splice(0,a.items)))}n.concatToResults(r)})}})}}}]).factory("jsonloaderFactory",["$http",function(t){var e={getJsonData:function(e){if("jsonp"===e.format){var r={method:"GET",params:{callback:"JSON_CALLBACK"}};return angular.isDefined(e.xAuthToken)&&(r.headers={"X-Auth-Token":e.xAuthToken}),t.jsonp(e.path,r)}r={method:"GET",url:e.path,params:{}};return angular.isDefined(e.xAuthToken)&&(r.headers={"X-Auth-Token":e.xAuthToken}),t(r)}};return e}]),angular.module("jtt_aping_json_string",[]).directive("apingJsonString",["apingUtilityHelper",function(o){return{require:"?aping",restrict:"A",replace:"false",link:function(e,r,t,a){var n=a.getAppSettings(),i=o.parseJsonFromAttributes(t.apingJsonString,"apingJsonString",n),s=[];i&&(i.constructor===Array?s=i:s.push(i),0<s.length&&a.concatToResults(s))}}}]),angular.module("jtt_aping_ng_array",[]).directive("apingNgArray",["apingUtilityHelper",function(i){return{require:"?aping",restrict:"A",replace:"false",link:function(t,e,r,a){var n=a.getAppSettings();i.parseJsonFromAttributes(r.apingNgArray,"ngArray",n).forEach(function(e){if(e.name&&t[e.name]){if(angular.isUndefined(e.items)&&(e.items=n.items),0===e.items||"0"===e.items)return!1;(e.items<0||isNaN(e.items))&&(e.items=void 0);var r=[];t[e.name].constructor===Array?(r=t[e.name],angular.isDefined(e.orderBy)&&("$RANDOM"===e.orderBy?r=i.shuffleArray(r):r.sort(i.sortArrayByProperty(e.orderBy))),angular.isDefined(e.orderReverse)&&!0===e.orderReverse&&"$RANDOM"!==e.orderBy&&r.reverse(),angular.isDefined(e.items)&&0<e.items&&r.length>e.items&&(r=r.splice(0,e.items))):"object"==typeof t[e.name]&&null!==t[e.name]&&r.push(t[e.name]),0<r.length&&a.concatToResults(r)}})}}}]),angular.module("jtt_aping_local_storage",[]).directive("apingLocalStorage",["apingUtilityHelper","apingLocalStorage",function(s,o){return{require:"?aping",restrict:"A",replace:"false",link:function(e,r,t,n){var i=n.getAppSettings();s.parseJsonFromAttributes(t.apingLocalStorage,"localStorage",i).forEach(function(a){if(a.key){if(angular.isUndefined(a.items)&&(a.items=i.items),0===a.items||"0"===a.items)return!1;(a.items<0||isNaN(a.items))&&(a.items=void 0),angular.isDefined(a.orderBy)&&!angular.isString(a.orderBy)&&(a.orderBy=void 0),!angular.isDefined(a.orderReverse)||!0!==a.orderReverse&&"true"!==a.orderReverse||(a.orderReverse=!0),o.get(a.key).then(function(e){var r=[];if(e){var t=e;angular.isDefined(a.resultProperty)&&(t=s.getValueFromObjectByPropertyString(e,a.resultProperty,!1)),angular.isArray(e)?(r=t,angular.isDefined(a.orderBy)&&("$RANDOM"===a.orderBy?r=s.shuffleArray(r):r.sort(s.sortArrayByProperty(a.orderBy))),angular.isDefined(a.orderReverse)&&!0===a.orderReverse&&"$RANDOM"!==a.orderBy&&r.reverse(),angular.isUndefined(a.items)?r=t:0<a.items&&r.length>a.items&&(r=r.splice(0,a.items))):r.push(t)}n.concatToResults(r)})}})}}}]).factory("apingLocalStorage",["$window","$q",function(a,n){return{set:function(e,r){var t=n.defer();return t.resolve(a.localStorage&&a.localStorage.setItem(e,angular.toJson(r))),t.promise},get:function(e){var r=n.defer();return r.resolve(a.localStorage&&angular.fromJson(a.localStorage.getItem(e))),r.promise}}}]),angular.module("jtt_aping_xml",[]).directive("apingXml",["apingUtilityHelper","xmlFactory","xmlService",function(s,o,l){return{require:"?aping",restrict:"A",replace:"false",link:function(e,r,t,n){var i=n.getAppSettings();s.parseJsonFromAttributes(t.apingXml,"xml",i).forEach(function(a){if(a.path){var e={path:a.path};if(angular.isUndefined(a.items)&&(a.items=i.items),0===a.items||"0"===a.items)return!1;(a.items<0||isNaN(a.items))&&(a.items=void 0),angular.isDefined(a.orderBy)&&!angular.isString(a.orderBy)&&(a.orderBy=void 0),!angular.isDefined(a.orderReverse)||!0!==a.orderReverse&&"true"!==a.orderReverse||(a.orderReverse=!0),o.getData(e).then(function(e){var r=[];if(e.data){var t=l.xml2json(e.data);angular.isDefined(a.resultProperty)&&(t=s.getValueFromObjectByPropertyString(t,a.resultProperty,!1)),t.constructor!==Array?r.push(t):(angular.extend(r,t),angular.isDefined(a.orderBy)&&("$RANDOM"===a.orderBy?r=s.shuffleArray(r):r.sort(s.sortArrayByProperty(a.orderBy))),angular.isDefined(a.orderReverse)&&!0===a.orderReverse&&"$RANDOM"!==a.orderBy&&r.reverse(),angular.isUndefined(a.items)?r=t:0<a.items&&r.length>a.items&&(r=r.splice(0,a.items)))}n.concatToResults(r)})}})}}}]).factory("xmlFactory",["$http",function(r){var e={getData:function(e){return r({method:"GET",url:e.path,params:{}})}};return e}]).service("xmlService",function(){var o=this;this.cleanXML=function(e){return e=(e=(e=(e=e.replace(/\n|\t|\r/g,"")).replace(/ {1,}<|\t{1,}</g,"<")).replace(/> {1,}|>\t{1,}/g,">")).replace(/<\?[^>]*\?>/g,""),e=o.replaceSelfClosingTags(e),e=o.replaceAloneValues(e),e=o.replaceAttributes(e)},this.replaceSelfClosingTags=function(e){var r=e.match(/<[^/][^>]*\/>/g);if(r)for(var t=0;t<r.length;t++){var a=r[t],n=a.substring(0,a.length-2);n+=">";var i=a.match(/[^<][\w+$]*/)[0],s="</"+i+">",o="<"+i+">",l=n.match(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g);if(l)for(var u=0;u<l.length;u++){var g=l[u],d=g.substring(0,g.indexOf("="));o+="<"+d+">"+g.substring(g.indexOf('"')+1,g.lastIndexOf('"'))+"</"+d+">"}o+=s,e=e.replace(a,o)}return e},this.replaceAloneValues=function(e){var r=e.match(/<[^\/][^>][^<]+\s+.[^<]+[=][^<]+>{1}([^<]+)/g);if(r)for(var t=0;t<r.length;t++){var a=r[t],n=a.substring(0,a.indexOf(">")+1)+"<_@ttribute>"+a.substring(a.indexOf(">")+1)+"</_@ttribute>";e=e.replace(a,n)}return e},this.replaceAttributes=function(e){var r=e.match(/<[^\/][^>][^<]+\s+.[^<]+[=][^<]+>/g);if(r)for(var t=0;t<r.length;t++){var a=r[t],n="<"+a.match(/[^<][\w+$]*/)[0]+">",i=a.match(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g);if(i)for(var s=0;s<i.length;s++){var o=i[s],l=o.substring(0,o.indexOf("="));n+="<"+l+">"+o.substring(o.indexOf('"')+1,o.lastIndexOf('"'))+"</"+l+">"}e=e.replace(a,n)}return e},this.xml2json=function(e){e=this.cleanXML(e);for(var r,t,a,n,i,s={};e.match(/<[^\/][^>]*>/);)r=(i=e.match(/<[^\/][^>]*>/)[0]).substring(1,i.length-1),-1==(t=e.indexOf(i.replace("<","</")))&&(r=i.match(/[^<][\w+$]*/)[0],-1==(t=e.indexOf("</"+r))&&(t=e.indexOf("<\\/"+r))),n=(a=e.substring(i.length,t)).match(/<[^\/][^>]*>/)?o.xml2json(a):a,void 0===s[r]?s[r]=n:Array.isArray(s[r])?s[r].push(n):s[r]=[s[r],n],e=e.substring(2*i.length+1+a.length);return s}});