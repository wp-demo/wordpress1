!function(){"use strict";var h=8,g=9,v=13,d=27,T=32,p=38,f=40,y=37,$=39,x=46,b=188,o=9007199254740991,t=["text","email","url"],e=angular.module("ngTagsInput",[]);e.directive("tagsInput",["$timeout","$document","$window","$q","tagsInputConfig","tiUtil",function(d,p,f,c,i,m){function a(i,n,a,t){var r,o,s,u,l={};return r=function(e){return m.safeToString(e[i.displayProperty])},o=function(e,t){e[i.displayProperty]=t},s=function(e){var t=r(e),n=t&&t.length>=i.minLength&&t.length<=i.maxLength&&i.allowedTagsPattern.test(t)&&!m.findInObjectArray(l.items,e,i.keyProperty||i.displayProperty);return c.when(n&&a({$tag:e})).then(m.promisifyValue)},u=function(e){return c.when(t({$tag:e})).then(m.promisifyValue)},l.items=[],l.addText=function(e){var t={};return o(t,e),l.add(t)},l.add=function(e){var t=r(e);return i.replaceSpacesWithDashes&&(t=m.replaceSpacesWithDashes(t)),o(e,t),s(e).then(function(){l.items.push(e),n.trigger("tag-added",{$tag:e})}).catch(function(){t&&n.trigger("invalid-tag",{$tag:e})})},l.remove=function(e){var t=l.items[e];return u(t).then(function(){return l.items.splice(e,1),l.clearSelection(),n.trigger("tag-removed",{$tag:t}),t})},l.select=function(e){e<0?e=l.items.length-1:e>=l.items.length&&(e=0),l.index=e,l.selected=l.items[e]},l.selectPrior=function(){l.select(--l.index)},l.selectNext=function(){l.select(++l.index)},l.removeSelected=function(){return l.remove(l.index)},l.clearSelection=function(){l.selected=null,l.index=-1},l.clearSelection(),l}function r(e){return-1!==t.indexOf(e)}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",text:"=?",templateScope:"=?",tagClass:"&",onTagAdding:"&",onTagAdded:"&",onInvalidTag:"&",onTagRemoving:"&",onTagRemoved:"&",onTagClicked:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(n,e,t){n.events=m.simplePubSub(),i.load("tagsInput",n,e,{template:[String,"ngTagsInput/tag-item.html"],type:[String,"text",r],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,o],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,o],displayProperty:[String,"text"],keyProperty:[String,""],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1],spellcheck:[Boolean,!0]}),n.tagList=new a(n.options,n.events,m.handleUndefinedResult(n.onTagAdding,!0),m.handleUndefinedResult(n.onTagRemoving,!0)),this.registerAutocomplete=function(){t.find("input");return{addTag:function(e){return n.tagList.add(e)},getTags:function(){return n.tagList.items},getCurrentTagText:function(){return n.newTag.text()},getOptions:function(){return n.options},getTemplateScope:function(){return n.templateScope},on:function(e,t){return n.events.on(e,t,!0),this}}},this.registerTagItem=function(){return{getOptions:function(){return n.options},removeTag:function(e){n.disabled||n.tagList.remove(e)}}}}],link:function(s,i,e,t){var n,a,u=[v,b,T,h,x,y,$],l=s.tagList,r=s.events,c=s.options,o=i.find("input"),g=["minTags","maxTags","allowLeftoverText"];n=function(){t.$setValidity("maxTags",l.items.length<=c.maxTags),t.$setValidity("minTags",l.items.length>=c.minTags),t.$setValidity("leftoverText",!(!s.hasFocus&&!c.allowLeftoverText)||!s.newTag.text())},a=function(){d(function(){o[0].focus()})},t.$isEmpty=function(e){return!e||!e.length},s.newTag={text:function(e){if(!angular.isDefined(e))return s.text||"";s.text=e,r.trigger("input-change",e)},invalid:null},s.track=function(e){return e[c.keyProperty||c.displayProperty]},s.getTagClass=function(e,t){var n=e===l.selected;return[s.tagClass({$tag:e,$index:t,$selected:n}),{selected:n}]},s.$watch("tags",function(e){e?(l.items=m.makeObjectArray(e,c.displayProperty),s.tags=l.items):l.items=[]}),s.$watch("tags.length",function(){n(),t.$validate()}),e.$observe("disabled",function(e){s.disabled=e}),s.eventHandlers={input:{keydown:function(e){r.trigger("input-keydown",e)},focus:function(){s.hasFocus||(s.hasFocus=!0,r.trigger("input-focus"))},blur:function(){d(function(){var e=p.prop("activeElement"),t=e===o[0],n=i[0].contains(e);!t&&n||(s.hasFocus=!1,r.trigger("input-blur"))})},paste:function(t){t.getTextData=function(){var e=t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData;return e?e.getData("text/plain"):f.clipboardData.getData("Text")},r.trigger("input-paste",t)}},host:{click:function(){s.disabled||a()}},tag:{click:function(e){r.trigger("tag-clicked",{$tag:e})}}},r.on("tag-added",s.onTagAdded).on("invalid-tag",s.onInvalidTag).on("tag-removed",s.onTagRemoved).on("tag-clicked",s.onTagClicked).on("tag-added",function(){s.newTag.text("")}).on("tag-added tag-removed",function(){s.tags=l.items,t.$setDirty(),a()}).on("invalid-tag",function(){s.newTag.invalid=!0}).on("option-change",function(e){-1!==g.indexOf(e.name)&&n()}).on("input-change",function(){l.clearSelection(),s.newTag.invalid=null}).on("input-focus",function(){i.triggerHandler("focus"),t.$setValidity("leftoverText",!0)}).on("input-blur",function(){c.addOnBlur&&!c.addFromAutocompleteOnly&&l.addText(s.newTag.text()),i.triggerHandler("blur"),n()}).on("input-keydown",function(e){var t,n,i,a,r=e.keyCode,o={};m.isModifierOn(e)||-1===u.indexOf(r)||(o[v]=c.addOnEnter,o[b]=c.addOnComma,o[T]=c.addOnSpace,t=!c.addFromAutocompleteOnly&&o[r],n=(r===h||r===x)&&l.selected,a=r===h&&0===s.newTag.text().length&&c.enableEditingLastTag,i=(r===h||r===y||r===$)&&0===s.newTag.text().length&&!c.enableEditingLastTag,t?l.addText(s.newTag.text()):a?(l.selectPrior(),l.removeSelected().then(function(e){e&&s.newTag.text(e[c.displayProperty])})):n?l.removeSelected():i&&(r===y||r===h?l.selectPrior():r===$&&l.selectNext()),(t||i||n||a)&&e.preventDefault())}).on("input-paste",function(e){if(c.addOnPaste){var t=e.getTextData().split(c.pasteSplitPattern);1<t.length&&(t.forEach(function(e){l.addText(e)}),e.preventDefault())}})}}}]),e.directive("tiTagItem",["tiUtil",function(o){return{restrict:"E",require:"^tagsInput",template:'<ng-include src="$$template"></ng-include>',scope:{$scope:"=scope",data:"="},link:function(t,e,n,i){var a=i.registerTagItem(),r=a.getOptions();t.$$template=r.template,t.$$removeTagSymbol=r.removeTagSymbol,t.$getDisplayText=function(){return o.safeToString(t.data[r.displayProperty])},t.$removeTag=function(){a.removeTag(t.$index)},t.$watch("$parent.$index",function(e){t.$index=e})}}}]),e.directive("autoComplete",["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function(e,t,n,l,i,c){function a(i,a,t){var r,o,s,u={};return s=function(){return a.tagsInput.keyProperty||a.tagsInput.displayProperty},r=function(e,t){return e.filter(function(e){return!c.findInObjectArray(t,e,s(),function(e,t){return a.tagsInput.replaceSpacesWithDashes&&(e=c.replaceSpacesWithDashes(e),t=c.replaceSpacesWithDashes(t)),c.defaultComparer(e,t)})})},u.reset=function(){o=null,u.items=[],u.visible=!1,u.index=-1,u.selected=null,u.query=null},u.show=function(){a.selectFirstMatch?u.select(0):u.selected=null,u.visible=!0},u.load=c.debounce(function(e,t){u.query=e;var n=l.when(i({$query:e}));(o=n).then(function(e){n===o&&(e=c.makeObjectArray(e.data||e,s()),e=r(e,t),u.items=e.slice(0,a.maxResultsToShow),0<u.items.length?u.show():u.reset())})},a.debounceDelay),u.selectNext=function(){u.select(++u.index)},u.selectPrior=function(){u.select(--u.index)},u.select=function(e){e<0?e=u.items.length-1:e>=u.items.length&&(e=0),u.index=e,u.selected=u.items[e],t.trigger("suggestion-selected",e)},u.reset(),u}return{restrict:"E",require:"^tagsInput",scope:{source:"&",matchClass:"&"},templateUrl:"ngTagsInput/auto-complete.html",controller:["$scope","$element","$attrs",function(e,t,n){e.events=c.simplePubSub(),i.load("autoComplete",e,n,{template:[String,"ngTagsInput/auto-complete-match.html"],debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1],selectFirstMatch:[Boolean,!0],displayProperty:[String,""]}),e.suggestionList=new a(e.source,e.options,e.events),this.registerAutocompleteMatch=function(){return{getOptions:function(){return e.options},getQuery:function(){return e.suggestionList.query}}}}],link:function(i,u,e,t){var n,a=[v,g,d,p,f],r=i.suggestionList,o=t.registerAutocomplete(),s=i.options,l=i.events;s.tagsInput=o.getOptions(),n=function(e){return e&&e.length>=s.minLength||!e&&s.loadOnEmpty},i.templateScope=o.getTemplateScope(),i.addSuggestionByIndex=function(e){r.select(e),i.addSuggestion()},i.addSuggestion=function(){var e=!1;return r.selected&&(o.addTag(angular.copy(r.selected)),r.reset(),e=!0),e},i.track=function(e){return e[s.tagsInput.keyProperty||s.tagsInput.displayProperty]},i.getSuggestionClass=function(e,t){var n=e===r.selected;return[i.matchClass({$match:e,$index:t,$selected:n}),{selected:n}]},o.on("tag-added tag-removed invalid-tag input-blur",function(){r.reset()}).on("input-change",function(e){n(e)?r.load(e,o.getTags()):r.reset()}).on("input-focus",function(){var e=o.getCurrentTagText();s.loadOnFocus&&n(e)&&r.load(e,o.getTags())}).on("input-keydown",function(e){var t=e.keyCode,n=!1;if(!c.isModifierOn(e)&&-1!==a.indexOf(t))return r.visible?t===f?(r.selectNext(),n=!0):t===p?(r.selectPrior(),n=!0):t===d?(r.reset(),n=!0):t!==v&&t!==g||(n=i.addSuggestion()):t===f&&i.options.loadOnDownArrow&&(r.load(o.getCurrentTagText(),o.getTags()),n=!0),n?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}),l.on("suggestion-selected",function(e){var t,n,i,a,r,o,s;t=e,n=u.find("li").eq(t),i=n.parent(),a=n.prop("offsetTop"),r=n.prop("offsetHeight"),o=i.prop("clientHeight"),s=i.prop("scrollTop"),a<s?i.prop("scrollTop",a):o+s<a+r&&i.prop("scrollTop",a+r-o)})}}}]),e.directive("tiAutocompleteMatch",["$sce","tiUtil",function(o,s){return{restrict:"E",require:"^autoComplete",template:'<ng-include src="$$template"></ng-include>',scope:{$scope:"=scope",data:"="},link:function(e,t,n,i){var a=i.registerAutocompleteMatch(),r=a.getOptions();e.$$template=r.template,e.$index=e.$parent.$index,e.$highlight=function(e){return r.highlightMatchedText&&(e=s.safeHighlight(e,a.getQuery())),o.trustAsHtml(e)},e.$getDisplayText=function(){return s.safeToString(e.data[r.displayProperty||r.tagsInput.displayProperty])}}}}]),e.directive("tiTranscludeAppend",function(){return function(e,t,n,i,a){a(function(e){t.append(e)})}}),e.directive("tiAutosize",["tagsInputConfig",function(s){return{restrict:"A",require:"ngModel",link:function(e,i,a,t){var r,n,o=s.getTextAutosizeThreshold();(r=angular.element('<span class="input"></span>')).css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),i.parent().append(r),n=function(e){var t,n=e;return angular.isString(n)&&0===n.length&&(n=a.placeholder),n&&(r.text(n),r.css("display",""),t=r.prop("offsetWidth"),r.css("display","none")),i.css("width",t?t+o+"px":""),e},t.$parsers.unshift(n),t.$formatters.unshift(n),a.$observe("placeholder",function(e){t.$modelValue||n(e)})}}}]),e.directive("tiBindAttrs",function(){return function(e,t,n){e.$watch(n.tiBindAttrs,function(e){angular.forEach(e,function(e,t){n.$set(t,e)})},!0)}}),e.provider("tagsInputConfig",function(){var f={},m={},t=3;this.setDefaults=function(e,t){return f[e]=t,this},this.setActiveInterpolation=function(e,t){return m[e]=t,this},this.setTextAutosizeThreshold=function(e){return t=e,this},this.$get=["$interpolate",function(d){var p={};return p[String]=function(e){return e},p[Number]=function(e){return parseInt(e,10)},p[Boolean]=function(e){return"true"===e.toLowerCase()},p[RegExp]=function(e){return new RegExp(e)},{load:function(u,l,c,e){var g=function(){return!0};l.options={},angular.forEach(e,function(e,t){var n,i,a,r,o,s;n=e[0],i=e[1],a=e[2]||g,r=p[n],o=function(){var e=f[u]&&f[u][t];return angular.isDefined(e)?e:i},s=function(e){l.options[t]=e&&a(e)?r(e):o()},m[u]&&m[u][t]?c.$observe(t,function(e){s(e),l.events.trigger("option-change",{name:t,newValue:e})}):s(c[t]&&d(c[t])(l.$parent))})},getTextAutosizeThreshold:function(){return t}}}]}),e.factory("tiUtil",["$timeout","$q",function(a,t){var r={debounce:function(t,n){var i;return function(){var e=arguments;a.cancel(i),i=a(function(){t.apply(null,e)},n)}},makeObjectArray:function(e,n){if(!angular.isArray(e)||0===e.length||angular.isObject(e[0]))return e;var i=[];return e.forEach(function(e){var t={};t[n]=e,i.push(t)}),i},findInObjectArray:function(e,t,n,i){var a=null;return i=i||r.defaultComparer,e.some(function(e){if(i(e[n],t[n]))return a=e,!0}),a},defaultComparer:function(e,t){return r.safeToString(e).toLowerCase()===r.safeToString(t).toLowerCase()},safeHighlight:function(e,t){if(!t)return e;e=r.encodeHTML(e),t=r.encodeHTML(t);var n=new RegExp("&[^;]+;|"+t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"gi");return e.replace(n,function(e){return e.toLowerCase()===t.toLowerCase()?"<em>"+e+"</em>":e})},safeToString:function(e){return angular.isUndefined(e)||null==e?"":e.toString().trim()},encodeHTML:function(e){return r.safeToString(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},handleUndefinedResult:function(t,n){return function(){var e=t.apply(null,arguments);return angular.isUndefined(e)?n:e}},replaceSpacesWithDashes:function(e){return r.safeToString(e).replace(/\s/g,"-")},isModifierOn:function(e){return e.shiftKey||e.ctrlKey||e.altKey||e.metaKey},promisifyValue:function(e){return e=!!angular.isUndefined(e)||e,t[e?"when":"reject"]()},simplePubSub:function(){var i={};return{on:function(e,t,n){return e.split(" ").forEach(function(e){i[e]||(i[e]=[]),(n?[].unshift:[].push).call(i[e],t)}),this},trigger:function(e,t){return(i[e]||[]).every(function(e){return r.handleUndefinedResult(e,!0)(t)}),this}}}};return r}]),e.run(["$templateCache",function(e){e.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="getTagClass(tag, $index)" ng-click="eventHandlers.tag.click(tag)"><ti-tag-item scope="templateScope" data="::tag"></ti-tag-item></li></ul><input class="input" autocomplete="off" ng-model="newTag.text" ng-model-options="{getterSetter: true}" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}" ti-autosize></div></div>'),e.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <a class="remove-button" ng-click="$removeTag()" ng-bind="::$$removeTagSymbol"></a>'),e.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="getSuggestionClass(item, $index)" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match scope="templateScope" data="::item"></ti-autocomplete-match></li></ul></div>'),e.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>')}])}();