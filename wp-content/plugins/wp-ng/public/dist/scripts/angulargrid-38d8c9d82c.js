!function(n,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("angular"),n):"function"==typeof define&&define.amd?define(["angular"],function(o){return t(o,n)}):t(n.angular,n)}(this,function(x,_,b){"use strict";var n,O={gridWidth:300,gutterSize:10,gridNo:"auto",direction:"ltor",refreshOnImgLoad:!0,cssGrid:!1,performantScroll:!1,pageSize:"auto",scrollContainer:"body",infiniteScrollDelay:3e3,infiniteScrollDistance:100},T=x.element,M=function(o){return o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},E={visibility:"hidden",opacity:0,top:0,left:0,width:""},N=(n=T(_),function(o){return n[0]=o,n});function D(o){return Array.prototype.slice.call(o)}return T(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),x.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(w,L,G,W){return{restrict:"A",scope:{model:"=angularGrid",dep_gridWidth:"=gridWidth",dep_gutterSize:"=gutterSize",dep_refreshOnImgLoad:"=refreshOnImgLoad",dep_direction:"=direction",dep_cssGrid:"=cssGrid",dep_options:"=angularGridOptions",dep_gridNo:"=gridNo",dep_agId:"@angularGridId",gridNo:"=agGridNo",gridWidth:"=agGridWidth",gutterSize:"=agGutterSize",refreshOnImgLoad:"=agRefreshOnImgLoad",direction:"=agDirection",cssGrid:"=agCssGrid",options:"=agOptions",agId:"@",pageSize:"=agPageSize",performantScroll:"=agPerformantScroll",scrollContainer:"@agScrollContainer",infiniteScroll:"&agInfiniteScroll",infiniteScrollDistance:"=agInfiniteScrollDistance",infiniteScrollDelay:"=agInfiniteScrollDelay"},link:function(p,m,o){var S,n,v,a=m[0],i=T(L),t=p.agId||p.dep_agId,I=0;function e(){v={},Object.keys(O).forEach(function(o){p[o]!==b?v[o]=p[o]:p["dep_"+o]!==b&&(v[o]=p["dep_"+o])}),(v=x.extend({},O,v,p.options||p.dep_options)).cssGrid&&(v.gutterSize=0),"auto"==v.pageSize&&(v.pageSize=768<=_.offsetWidth?2:3)}m.addClass("angular-grid"),["gridWidth","gutterSize","refreshOnImgLoad","direction","options","cssGrid","gridNo","agId"].forEach(function(o){var n=M(o),t="ag-"+M(o);"options"==o&&(n="angular-grid-options"),"agId"==o&&(n="angular-grid-id",t="ag-id"),p["dep_"+o]!==b&&console&&console.warn&&console.warn(n+" is deprecated. Use "+t+" instead in template.")}),e();var C={};function y(){var o=T(document.querySelector(v.scrollContainer)),n=o[0],t="body"===v.scrollContainer?i:o;return{height:t[0].innerHeight||t[0].offsetHeight,scrollHeight:n.scrollHeight,startFrom:function(o,n){n=n||document.body;var t=0,i=0;if(o.offsetParent)for(;t+=o.offsetLeft,i+=o.offsetTop,(o=o.offsetParent)&&o!=n;);return{left:t,top:i}}(a,n).top,$elm:t}}function $(o){var n;if(C.lastScrollPosition=o,!C.isBusy){var t=0,i=v.pageSize;if(o>C.scrollContInfo.startFrom+C.scrollContInfo.height*i&&(t=Math.floor((o-C.scrollContInfo.startFrom)/(C.scrollContInfo.height*i))),t!=C.lastPage){C.lastPage=t;var e=C.pageInfo[t];e&&(m.children().detach(),function(o){var n,t,i,e;for(i=0,e=S.length;i<e;i++)(n=(t=N(S[i])).data()).$scope&&(t.data("_agOldWatchers",n.$scope.$$watchers),n.$scope.$$watchers=[]);for(i=0,e=o.length;i<e;i++)(n=N(o[i]).data()).$scope&&(n.$scope.$$watchers=n._agOldWatchers||[],n.$scope.$digest())}(n=Array.prototype.slice.call(S,e.from,e.to+1)),m.append(n))}}}function z(){clearTimeout(C.infiniteScrollTimeout),C.isLoading=!1}function r(o){!C.isLoading&&p.model.length&&(o>=C.scrollContInfo.scrollHeight-C.scrollContInfo.height*(1+v.infiniteScrollDistance/100)&&(C.isLoading=!0,p.infiniteScroll(),C.infiniteScrollTimeout=setTimeout(z,v.infiniteScrollDelay)))}function l(){var o=this.scrollTop||this.scrollY;v.performantScroll&&$(o),p.infiniteScroll&&r(o)}function s(o,n){var i=n.beforeLoad||x.noop,e=n.onLoad||x.noop,r=n.isLoaded||x.noop,t=n.onFullLoad||x.noop,a=n.ignoreCheck||x.noop,l=o.find("img"),s=[];D(l).forEach(function(t){var o;t.src&&(i(t),(o=t).complete&&(void 0===o.naturalWidth||0!==o.naturalWidth)||a(t)?r(t):s.push(G(function(o,n){t.onload=function(){e(t),o()},t.onerror=n})))}),s.length?G.all(s).then(t,t):setTimeout(function(){t()},0)}function d(){if(S&&S.length){I++;var o,n=function(){var o,n=a.offsetWidth;if(v.cssGrid){(o=T(S[0]).clone()).css(E).addClass("ag-no-transition ag-clone"),m.append(o);var t=o[0].offsetWidth;return o.remove(),{no:t?Math.floor((n+12)/t):0,width:t}}var i="auto"==v.gridNo?v.gridWidth:Math.floor(n/v.gridNo)-v.gutterSize,e="auto"==v.gridNo?Math.floor((n+v.gutterSize)/(i+v.gutterSize)):v.gridNo,r=(n+v.gutterSize)%(i+v.gutterSize);return{no:e,width:i+=Math.floor(r/e)}}(),f=n.width,t=n.no;if(t){var g=[];for(o=0;o<t;o++)g.push(0);D(S).forEach(function(o){var e=N(o);D(e.find("img")).forEach(function(o){var n=T(o);if(n.hasClass("img-loaded"))n.css("height","");else{e.addClass("ag-no-transition"),e.css("width",f+"px");var t=n.attr("actual-width")||n.attr("data-actual-width"),i=n.attr("actual-height")||n.attr("data-actual-height");t&&i&&n.css("height",i*o.width/t+"px")}}),e.removeClass("ag-no-transition")});var u=S.clone();u.addClass("ag-no-transition ag-clone");var h,i=x.extend({},E);i.width=f+"px",u.css(i),m.append(u),h=I,s(u,{ignoreCheck:function(o){return!N(o).hasClass("img-loaded")},onFullLoad:function(){if(h<I)u.remove();else{var o,n,t,i=[],e=[];for(n=0,t=u.length;n<t;n++)i.push(u[n].offsetHeight);for(n=0,t=S.length;n<t;n++){o=N(S[n]);var r=i[n],a=Math.min.apply(Math,g),l=g.indexOf(a);g[l]=a+r+v.gutterSize;var s=l*(f+v.gutterSize),d={position:"absolute",top:a+"px"};"rtol"==v.direction?d.right=s+"px":d.left=s+"px",d.width=f+"px",e.push({top:a,bottom:a+r}),o.css(d).addClass("angular-grid-item")}var c=Math.max.apply(Math,g);m.css("height",c+"px"),u.remove(),(v.performantScroll||p.infiniteScroll)&&(C.scrollContInfo=y()),v.performantScroll&&(C.lastPage=null,function(o,n,t){C.pageInfo=[{from:0}];var i,e,r,a=v.pageSize,l=C.scrollContInfo.height*a,s=Math.ceil(n/l),d=0;for(d=0;d<s;d++)for(var c=0,f=o.length;c<f;c++)if(e=d?l*d:0,r=l*(d+1),(i=o[c]).bottom<e||i.top>r){if(i.top>r)break}else C.pageInfo[d]||(C.pageInfo[d]={from:c}),C.pageInfo[d].to=c;C.pageInfo=C.pageInfo.map(function(o,n){var t=Math.max(n-1,0),i=Math.min(n+1,C.pageInfo.length-1);return{from:C.pageInfo[t].from,to:C.pageInfo[i].to}})}(e,c),C.isBusy=!1,$(C.lastScrollPosition||0)),z()}}})}}}function c(){return T(D(m.children()).filter(function(o){return!N(o).hasClass("ag-clone")}))}function f(){C.isBusy=!0,w(function(){var n;S=c(),(n=D(S).filter(function(o){return N(o).hasClass("ng-leave")}),G(function(o){n.length?N(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){w(function(){S=c(),o()})}):o()})).then(function(){var t;t=!1,D(S).forEach(function(o){var n=T(o);n.find("img").length&&(n.addClass("img-loading"),s(n,{beforeLoad:function(o){N(o).addClass("img-loading")},isLoaded:function(o){N(o).removeClass("img-loading").addClass("img-loaded")},onLoad:function(o){!t&&v.refreshOnImgLoad&&(t=!0,w(function(){d(),t=!1},100)),N(o).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){n.removeClass("img-loading").addClass("img-loaded")}}))}),w(function(){d()})})})}function g(){e(),S&&d()}setTimeout(function(){C.scrollContInfo=y(),C.scrollContInfo.$elm.on("scroll",l)},0),p.$watch("model",f,!0),p.$watch("options",g,!0),Object.keys(O).forEach(function(o){p[o]!==b&&p.$watch(o,g)});var u=a.offsetWidth;function h(){C.isBusy=!0;var o=a.offsetWidth;u!=o&&(u=o,n&&w.cancel(n),n=w(function(){v.performantScroll&&(m.children().detach(),m.append(S)),d()},100))}i.on("resize",h),t&&(W[t]={refresh:function(){f()},handleScroll:function(o){v.performantScroll&&$(o),p.infiniteScroll&&r(o)}}),p.$on("$destroy",function(){t&&delete W[t],i.off("resize",h),clearTimeout(C.infiniteScrollTimeout),C.scrollContInfo&&C.scrollContInfo.$elm.off("scroll",l)})}}}]).factory("angularGridInstance",function(){return{}}).name});