!function(){"use strict";angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0,clearOnBlurPlaceholder:!1,escChar:"\\",eventsToHandle:["input","keyup","click","focus"],addDefaultPlaceholder:!0,allowInvalidValue:!1}).provider("uiMask.Config",function(){var a={};this.maskDefinitions=function(e){return a.maskDefinitions=e},this.clearOnBlur=function(e){return a.clearOnBlur=e},this.clearOnBlurPlaceholder=function(e){return a.clearOnBlurPlaceholder=e},this.eventsToHandle=function(e){return a.eventsToHandle=e},this.addDefaultPlaceholder=function(e){return a.addDefaultPlaceholder=e},this.allowInvalidValue=function(e){return a.allowInvalidValue=e},this.$get=["uiMaskConfig",function(e){var n=e;for(var t in a)angular.isObject(a[t])&&!angular.isArray(a[t])?angular.extend(n[t],a[t]):n[t]=a[t];return n}]}).directive("uiMask",["uiMask.Config",function(e){function L(e){return e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(e.type||e.href||~e.tabIndex)}return{priority:100,require:"ngModel",restrict:"A",compile:function(){var F=angular.copy(e);return function(E,M,c,O){var D,s,P,f,h,t,a,x,C,S,A,T,i=!1,n=!1,r=c.placeholder,e=c.maxlength,l=O.$isEmpty;function u(e){return angular.isDefined(e)?(function(e){var r=0;if(D=[],s=[],P="",angular.isString(e)){var l=!1,u=h=0,n=e.split(""),o=!1;angular.forEach(n,function(e,n){var t,a,i;o?(o=!1,P+=e,r++):g.escChar===e?o=!0:g.maskDefinitions[e]?(D.push(r),P+=(t=n-u,i=angular.isDefined(c.uiMaskPlaceholder)?c.uiMaskPlaceholder:c.placeholder,angular.isDefined(i)&&i[t]?i[t]:"space"===(a=angular.isDefined(c.uiMaskPlaceholderChar)&&c.uiMaskPlaceholderChar?c.uiMaskPlaceholderChar:"_").toLowerCase()?" ":a[0]),s.push(g.maskDefinitions[e]),r++,l||h++,l=!1):"?"===e?(l=!0,u++):(P+=e,r++)})}D.push(D.slice().pop()+1),f=function(){var t,e,n=P.split("");D&&!isNaN(D[0])&&angular.forEach(D,function(e){n[e]="_"});t=n.join(""),e=(e=t.replace(/[_]+/g,"_").split("_")).filter(function(e){return""!==e});var a=0;return e.map(function(e){var n=t.indexOf(e,a);return a=n+1,{value:e,position:n}})}(),i=1<D.length}(e),i?(function(){t=C=B(O.$modelValue||""),x=I(t),a=m(t),c.maxlength&&M.attr("maxlength",2*D[D.length-1]);!r&&g.addDefaultPlaceholder&&M.attr("placeholder",P);var e=O.$modelValue,n=O.$formatters.length;for(;n--;)e=O.$formatters[n](e);O.$viewValue=e||"",O.$render()}(),function(){if(n)return;M.bind("blur",k),M.bind("mousedown mouseup",w),M.bind("keydown",$),M.bind(g.eventsToHandle.join(" "),V),n=!0}(),!0):p()):p()}function o(e){e&&(P=e,!i||0===M.val().length&&angular.isDefined(c.placeholder)||M.val(I(B(M.val()))))}var d=!(O.$isEmpty=function(e){return l(i?B(e||""):e)});function v(e){return i?(t=B(e||""),a=m(t),O.$setValidity("mask",a),t.length&&(a||g.allowInvalidValue)?I(t):void 0):e}c.$observe("modelViewValue",function(e){"true"===e&&(d=!0)}),c.$observe("allowInvalidValue",function(e){g.allowInvalidValue=""===e||!!e,v(O.$modelValue)});var g={};function p(){return i=!1,function(){if(!n)return;M.unbind("blur",k),M.unbind("mousedown",w),M.unbind("mouseup",w),M.unbind("keydown",$),M.unbind("input",V),M.unbind("keyup",V),M.unbind("click",V),M.unbind("focus",V),n=!1}(),angular.isDefined(r)?M.attr("placeholder",r):M.removeAttr("placeholder"),angular.isDefined(e)?M.attr("maxlength",e):M.removeAttr("maxlength"),M.val(O.$modelValue),O.$viewValue=O.$modelValue,!1}function m(e){return!e.length||e.length>=h}function B(t){var a,i,n="",e=M[0],r=s.slice(),l=S,u=l+_(e),o="";return t=t.toString(),a=0,i=t.length-P.length,angular.forEach(f,function(e){var n=e.position;l<=n&&n<u||(l<=n&&(n+=i),t.substring(n,n+e.value.length)===e.value&&(o+=t.slice(a,n),a=n+e.value.length))}),t=o+t.slice(a),angular.forEach(t.split(""),function(e){r.length&&r[0].test(e)&&(n+=e,r.shift())}),n}function I(t){var a="",i=D.slice();return angular.forEach(P.split(""),function(e,n){t.length&&n===i[0]?(a+=t.charAt(0)||"_",t=t.substr(1),i.shift()):a+=e}),a}g=c.uiOptions?(g=E.$eval("["+c.uiOptions+"]"),angular.isObject(g[0])?function(e,n){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===n[t]?n[t]=angular.copy(e[t]):angular.isObject(n[t])&&!angular.isArray(n[t])&&(n[t]=angular.extend({},e[t],n[t])));return n}(F,g[0]):F):F,c.$observe("uiMask",u),angular.isDefined(c.uiMaskPlaceholder)?c.$observe("uiMaskPlaceholder",o):c.$observe("placeholder",o),angular.isDefined(c.uiMaskPlaceholderChar)&&c.$observe("uiMaskPlaceholderChar",function(){return u(c.uiMask)}),O.$formatters.unshift(v),O.$parsers.unshift(function(e){return i?(t=B(e||""),a=m(t),O.$viewValue=t.length?I(t):"",O.$setValidity("mask",a),a||g.allowInvalidValue?d?O.$viewValue:t:void 0):e});var b=M.val();function k(){if((g.clearOnBlur||g.clearOnBlurPlaceholder&&0===t.length&&c.placeholder)&&(A=S=0,a&&0!==t.length||("",M.val(""),E.$apply(function(){O.$pristine||O.$setViewValue("")}))),t!==b){var e=M.val(),n=""===t&&e&&angular.isDefined(c.uiMaskPlaceholderChar)&&"space"===c.uiMaskPlaceholderChar;n&&M.val(""),function(e){var n;if(angular.isFunction(window.Event)&&!e.fireEvent)try{n=new Event("change",{view:window,bubbles:!0,cancelable:!1})}catch(e){(n=document.createEvent("HTMLEvents")).initEvent("change",!1,!0)}finally{e.dispatchEvent(n)}else"createEvent"in document?((n=document.createEvent("HTMLEvents")).initEvent("change",!1,!0),e.dispatchEvent(n)):e.fireEvent&&e.fireEvent("onchange")}(M[0]),n&&M.val(e)}b=t}function w(e){"mousedown"===e.type?M.bind("mouseout",y):M.unbind("mouseout",y)}function y(){A=_(this),M.unbind("mouseout",y)}function $(e){var n=8===e.which,t=H(this)-1||0,a=90===e.which&&e.ctrlKey;if(n){for(;0<=t;){if(j(t)){R(this,t+1);break}t--}T=-1===t}a&&(M.val(""),e.preventDefault())}function V(e){var n=(e=e||{}).which,t=e.type;if(16!==n&&91!==n){var a,i=M.val(),r=x,l=!1,u=B(i),o=C,c=H(this)||0,s=S||0,f=c-s,h=D[0],d=D[u.length]||D.slice().shift(),v=A||0,g=0<_(this),p=0<v,m=i.length>r.length||v&&i.length>r.length-v,b=i.length<r.length||v&&i.length===r.length-v,k=37<=n&&n<=40&&e.shiftKey,w=8===n||"keyup"!==t&&b&&-1===f,y=46===n||"keyup"!==t&&b&&0===f&&!p,$=(37===n||w||"click"===t)&&h<c;if(A=_(this),!k&&(!g||"click"!==t&&"keyup"!==t&&"focus"!==t)){if(w&&T)return M.val(P),E.$apply(function(){O.$setViewValue("")}),void R(this,s);if("input"===t&&b&&!p&&u===o){for(;w&&h<c&&!j(c);)c--;for(;y&&c<d&&-1===D.indexOf(c);)c++;var V=D.indexOf(c);(u=u.substring(0,V)+u.substring(V+1))!==o&&(l=!0)}for(a=I(u),x=a,C=u,!l&&i.length>a.length&&(l=!0),M.val(a),l&&E.$apply(function(){O.$setViewValue(a)}),m&&c<=h&&(c=h+1),$&&c--,c=d<c?d:c<h?h:c;!j(c)&&h<c&&c<d;)c+=$?-1:1;($&&c<d||m&&!j(s))&&c++,R(this,S=c)}}}function j(e){return-1<D.indexOf(e)}function H(e){if(!e)return 0;if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection&&L(M[0])){e.focus();var n=document.selection.createRange();return n.moveStart("character",e.value?-e.value.length:0),n.text.length}return 0}function R(e,n){if(!e)return 0;if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)L(M[0])&&(e.focus(),e.setSelectionRange(n,n));else if(e.createTextRange){var t=e.createTextRange();t.collapse(!0),t.moveEnd("character",n),t.moveStart("character",n),t.select()}}function _(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:window.getSelection?window.getSelection().toString().length:document.selection?document.selection.createRange().text.length:0:0}M.bind("mousedown mouseup",w),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var n=Object(this),t=n.length>>>0;if(0===t)return-1;var a=0;if(1<arguments.length&&((a=Number(arguments[1]))!=a?a=0:0!==a&&a!==1/0&&a!==-1/0&&(a=(0<a||-1)*Math.floor(Math.abs(a)))),t<=a)return-1;for(var i=0<=a?a:Math.max(t-Math.abs(a),0);i<t;i++)if(i in n&&n[i]===e)return i;return-1})}}}}])}();