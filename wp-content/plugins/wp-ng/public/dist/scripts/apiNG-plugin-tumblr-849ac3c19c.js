"use strict";angular.module("jtt_aping_tumblr",["jtt_tumblr"]).directive("apingTumblr",["apingTumblrHelper","apingUtilityHelper","tumblrFactory",function(r,s,n){return{require:"?aping",restrict:"A",replace:"false",link:function(t,e,i,a){var o=a.getAppSettings();s.parseJsonFromAttributes(i.apingTumblr,r.getThisPlatformString(),o).forEach(function(t){var e={model:o.model};void 0!==o.getNativeData?e.getNativeData=o.getNativeData:e.getNativeData=!1;var i={api_key:s.getApiCredentials(r.getThisPlatformString(),"api_key"),filter:"text"};if(void 0!==t.items?i.limit=t.items:i.limit=o.items,0==i.limit)return!1;if((i.limit<0||isNaN(i.limit))&&(i.limit=void 0),20<i.limit&&(i.limit=20),0===i.limit||"0"===i.limit)return!1;if(void 0!==t.tag&&(i.tag=t.tag),t.page){switch(i.page=t.page,o.model){case"image":i.type="photo";break;case"video":i.type="video";break;case"social":break;default:return!1}n.getPostsFromPage(i).then(function(t){t&&a.concatToResults(r.getObjectByJsonData(t,e))})}})}}}]),angular.module("jtt_aping_tumblr").service("apingTumblrHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,t,e){this.getThisPlatformString=function(){return"tumblr"},this.getThisBlogLink=function(t){return"http://"+t+".tumblr.com/"},this.getDifference=function(t,e){return e<t?t-e:e-t},this.getImagesFromImageArray=function(t){var i=this,a={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return t.constructor===Array&&angular.forEach(t,function(t,e){void 0!==t.url&&(void 0===a.thumb_url?(a.thumb_url=t.url,a.thumb_width=t.width,a.thumb_height=t.height):i.getDifference(a.thumb_width,200)>i.getDifference(t.width,200)&&200<=t.width&&(a.thumb_url=t.url,a.thumb_width=t.width,a.thumb_height=t.height),void 0===a.img_url?(a.img_url=t.url,a.img_width=t.width,a.img_height=t.height):i.getDifference(a.img_width,700)>i.getDifference(t.width,700)&&(a.img_url=t.url,a.img_width=t.width,a.img_height=t.height),void 0===a.native_url?(a.native_url=t.url,a.native_width=t.width,a.native_height=t.height):t.width>a.native_width&&(a.native_url=t.url,a.native_width=t.width,a.native_height=t.height))}),a},this.getObjectByJsonData=function(t,a){var o=[];if(t&&t.data&&t.data.response){var r=this;t.data.response.posts&&angular.forEach(t.data.response.posts,function(t,e){var i;(i=!0===a.getNativeData||"true"===a.getNativeData?t:r.getItemByJsonData(t,a.model))&&o.push(i)})}return o},this.getItemByJsonData=function(t,e){var i={};if(t&&e)switch(e){case"social":i=this.getSocialItemByJsonData(t);break;case"video":i=this.getVideoItemByJsonData(t);break;case"image":i=this.getImageItemByJsonData(t);break;default:return!1}return i},this.getSocialItemByJsonData=function(t){var e=a.getNew("social",this.getThisPlatformString());switch(angular.extend(e,{blog_name:t.blog_name||void 0,blog_link:t.blog_name?this.getThisBlogLink(t.blog_name):void 0,type:t.type||void 0,timestamp:t.timestamp?1e3*t.timestamp:void 0,post_url:t.short_url||void 0,intern_id:t.id||void 0}),t.type){case"photo":if(e.text=t.caption||void 0,t.photos&&t.photos[0]&&t.photos[0].alt_sizes&&0<t.photos[0].alt_sizes.length&&(e.source=t.photos,t.photos&&t.photos[0]&&t.photos[0].alt_sizes&&0<t.photos[0].alt_sizes.length)){e.source=t.photos;var i=this.getImagesFromImageArray(t.photos[0].alt_sizes);angular.extend(e,i)}break;case"link":if(e.text=t.description||void 0,e.text?e.caption=t.title||void 0:e.text=t.title||void 0,t.photos&&t.photos[0]&&t.photos[0].alt_sizes&&0<t.photos[0].alt_sizes.length&&(e.source=t.photos,t.photos&&t.photos[0]&&t.photos[0].alt_sizes&&0<t.photos[0].alt_sizes.length)){e.source=t.photos;i=this.getImagesFromImageArray(t.photos[0].alt_sizes);angular.extend(e,i)}break;case"video":e.text=t.caption||void 0,t.thumbnail_url&&(e.img_url=t.thumbnail_url,e.thumb_url=t.thumbnail_url,e.native_url=t.thumbnail_url),t.player&&(e.source=t.player);break;case"text":e.text=t.body||void 0,e.text?e.caption=t.title||void 0:e.text=t.title||void 0;break;case"audio":e.text=t.caption||void 0,t.player&&(e.source=t.player);break;default:return!1}return e.date_time=new Date(e.timestamp),e},this.getVideoItemByJsonData=function(t){var i=a.getNew("video",this.getThisPlatformString());return angular.extend(i,{blog_name:t.blog_name||void 0,blog_link:t.blog_name?this.getThisBlogLink(t.blog_name):void 0,type:t.type||void 0,timestamp:t.timestamp?1e3*t.timestamp:void 0,post_url:t.short_url||void 0,intern_id:t.id||void 0,text:t.caption||void 0,img_url:t.thumbnail_url||void 0,thumb_url:t.thumbnail_url||void 0,native_url:t.thumbnail_url||void 0}),angular.forEach(t.player,function(t,e){(void 0===i.markup||t.width>i.width)&&(i.markup=t.embed_code,i.width=t.width)}),i.date_time=new Date(i.timestamp),i},this.getImageItemByJsonData=function(t){var e=a.getNew("image",this.getThisPlatformString());if(angular.extend(e,{blog_name:t.blog_name||void 0,blog_link:t.blog_name?this.getThisBlogLink(t.blog_name):void 0,type:t.type||void 0,timestamp:t.timestamp?1e3*t.timestamp:void 0,post_url:t.short_url||void 0,intern_id:t.id||void 0}),e.text=t.caption||void 0,t.photos&&t.photos[0]&&t.photos[0].alt_sizes&&0<t.photos[0].alt_sizes.length){e.source=t.photos;var i=this.getImagesFromImageArray(t.photos[0].alt_sizes);angular.extend(e,i)}return e.date_time=new Date(e.timestamp),e}}]),angular.module("jtt_tumblr",[]).factory("tumblrFactory",["$http","tumblrSearchDataService",function(i,a){var t={getPostsFromPage:function(t){var e=a.getNew("postsFromPage",t);return i.jsonp(e.url,{method:"GET",params:e.object})},getInfoFromPage:function(t){var e=a.getNew("infoFromPage",t);return i.jsonp(e.url,{method:"GET",params:e.object})},getAvatarFromPage:function(t){var e=a.getNew("avatarFromPage",t);return i.jsonp(e.url,{method:"GET",params:e.object})}};return t}]).service("tumblrSearchDataService",function(){this.getApiBaseUrl=function(t){return"https://api.tumblr.com/"+(t&&void 0!==t.version?t.version+"/":"v2/")+"blog/"},this.fillDataInObjectByList=function(i,a,t){return angular.forEach(t,function(t,e){void 0!==a[t]&&(i.object[t]=a[t])}),i},this.getNew=function(t,e){var i={object:{api_key:e.api_key||void 0,callback:"JSON_CALLBACK"},url:""};switch(void 0!==e.limit&&(i.object.limit=e.limit),t){case"postsFromPage":(i=this.fillDataInObjectByList(i,e,["type","id","tag","offset","reblog_info","notes_info","filter"])).url=this.getApiBaseUrl()+e.page+".tumblr.com/posts";break;case"infoFromPage":i.object.limit=void 0,i.url=this.getApiBaseUrl()+e.page+".tumblr.com/info";break;case"avatarFromPage":var a="";(i.object.limit=void 0)!==e.size&&(a="/"+e.size),i.url=this.getApiBaseUrl()+e.page+".tumblr.com/avatar"+a}return i}});