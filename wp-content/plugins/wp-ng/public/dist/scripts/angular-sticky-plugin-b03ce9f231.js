"use strict";angular.module("hl.sticky",[]).factory("mediaQuery",function(){return{matches:function(t){return t&&(matchMedia("("+t+")").matches||matchMedia(t).matches)}}}).factory("hlStickyStack",["$document","DefaultStickyStackName",function(t,r){var a=t[0].documentElement,i={};return function(t){var n=(t=t||{}).name||r;if(i[n])return i[n];var e=1039,l=[],o={};return o.options=t,o.stackName=n,o.add=function(t,n){return angular.isString(t)&&""!==t||(t=o.length()),n.id=t,n.zIndex=e,l.push(n),e-=1,n},o.get=function(t){for(var n=0;n<l.length;n++)if(t==l[n].id)return l[n];return!1},o.index=function(t){for(var n=0;n<l.length;n++)if(t==l[n].id)return n;return-1},o.range=function(t,n){return l.slice(t,n)},o.all=function(){return l},o.keys=function(){for(var t=[],n=0;n<l.length;n++)t.push(l[n].id);return t},o.top=function(){return l[l.length-1]},o.remove=function(t){for(var n=0;n<l.length;n++)if(t==l[n].id)return e+=1,l.splice(n,1)[0];return!1},o.removeTop=function(){return e+=1,l.splice(l.length-1,1)[0]},o.length=function(){return l.length},o.height=function(n){var e={top:0,bottom:0};return angular.forEach(l,function(t){e[t.anchor()]+=t.computedHeight(n)}),e[n]},o.heightAt=function(t,n){for(var e,o,r=n-1,a={top:0,bottom:0},i=0;i<l.length;i++)if((e=l[i]).sticksAtPosition(t,r)){var c=e.anchor();o=e.computedHeight(t,r-a[c]),a[c]+=o}return a[t]},o.heightCurrent=function(t){return o.heightAt(t,window.pageYOffset||a.scrollTop)},i[n]=o}}]).factory("hlStickyElement",["$document","$log","hlStickyStack","throttle","mediaQuery",function(Q,A,N,t,O){return function(e,r){var t,n,o;r=r||{};var a=!1,i=angular.element(Q[0].body),c=e[0],l=Q[0].documentElement,u=r.id||null,f=!!angular.isDefined(r.mediaQuery)&&r.mediaQuery,s=angular.isString(r.stickyClass)&&""!==r.stickyClass?r.stickyClass:"is-sticky",d=!angular.isDefined(r.usePlaceholder)||r.usePlaceholder,h=r.offsetTop?parseInt(r.offsetTop):0,m=r.offsetBottom?parseInt(r.offsetBottom):0,g="string"==typeof r.anchor?r.anchor.toLowerCase().trim():"top",y=null,p=!1===r.stack?null:r.stack||N(),v=angular.isFunction(r.event)?r.event:angular.noop,k={top:0,bottom:0},w={style:e.attr("style")||""};function S(){return a?t:t=H(c)-h-P("top")}function b(){return a?n:n=H(t=c)+t.clientHeight+m+P("bottom");var t}function E(){return!angular.isDefined(r.enable)||r.enable}function x(t,n){if(!1!==f&&!O.matches(f))return!1;switch(t){case"top":return(o=void 0!==(o=n)?o:window.pageYOffset||i.scrollTop)-(l.clientTop||0)>=S();case"bottom":return(e=void 0!==(e=n)?e:window.pageYOffset||i.scrollTop)+window.innerHeight<=b();default:A.error('Unknown anchor "'+t+'"')}var e,o;return!1}function $(){var t=x(g);angular.isDefined(r.enable)&&!r.enable&&(t=!1),angular.isDefined(r.alwaysSticky)&&r.alwaysSticky&&(t=!0),t&&!a?(!function(){a=!0,e.addClass(s),d&&((o=o||angular.element("<div>")).css("height",z()+"px"),e.after(o));var t=c.getBoundingClientRect(),n={width:D()+"px",position:"fixed",left:t.left+"px","z-index":p?p.get(u).zIndex-(k.zIndex||0):null};n["margin-"+g]=0,e.css(n)}(),v({event:"stick"})):!t&&a&&(C(),v({event:"unstick"})),a&&("top"===g?e.css("top",h+P(g)-I()+"px"):"bottom"===g&&e.css("bottom",m+P(g)-T()+"px"),e.css("width",D()+"px"))}function C(){a=!1,e.removeClass(s),e.attr("style",w.style),o&&o.remove()}function D(){return c.offsetWidth}function z(){return c.offsetHeight}function H(t){var n=0;if(t&&t.offsetParent)for(;n+=t.offsetTop,t=t.offsetParent;);return n}function P(n){var e=0;if("top"===n&&0<k.top&&(e+=k.top),"bottom"===n&&0<k.bottom&&(e+=k.bottom),p){var t=p.index(u);"top"===n&&0<t&&p.range(0,t).forEach(function(t){t.isSticky()&&(e+=t.computedHeight(n))}),"bottom"===n&&t!==p.length()-1&&p.range(t+1,p.length()).forEach(function(t){t.isSticky()&&(e+=t.computedHeight(n))})}return e}function T(t){if(null===y&&(y=void 0!==r.container&&(angular.isString(r.container)?angular.element(l.querySelector("#"+r.container))[0]:r.container)),y){var n=!(null==t),e=y.getBoundingClientRect(),o=n?H(y)+e.height-t:e.top-window.innerHeight+z();return Math.max(0,o-(h+P(g)))}return 0}function I(t){if(null===y&&(y=void 0!==r.container&&(angular.isString(r.container)?angular.element(l.querySelector("#"+r.container))[0]:r.container)),y){var n=!(null==t),e=y.getBoundingClientRect(),o=n?H(y)+e.height-t:e.bottom;return Math.max(0,h+P(g)+z()-o)}return 0}var M={};if(p){var B=p.add(u,M);u=B.id}return M.draw=function(t){var n=(t=t||{}).offset;n&&(k.top=n.top||0,k.bottom=n.bottom||0,k.zIndex=n.zIndex),!0===t.force&&C(),$()},M.anchor=function(){return g},M.isSticky=function(){return E()&&a||r.alwaysSticky},M.isEnabled=E,M.computedHeight=function(t,n){return"top"===t?Math.max(0,z()-I(n)+h):"bottom"===t?Math.max(0,z()-T(n)+m):0},M.sticksAtPosition=x,M.destroy=function(){C(),p&&p.remove(u)},M}}]).constant("DefaultStickyStackName","default-stack").provider("hlStickyElementCollection",function(){var p=0,v={collections:{},defaults:{checkDelay:250},elementsDefaults:{},$get:["$rootScope","$window","$document","$log","DefaultStickyStackName","hlStickyElement","hlStickyStack","throttle",function(e,t,n,i,c,l,u,f){var s,d,h,m=angular.element(t);function g(){o()}function y(){o({force:!0})}function o(n){angular.forEach(v.collections,function(t){t.draw(n)})}return function(o){o&&angular.isObject(o)||(i.warn("Must supply an options object"),o={});var t=(o=angular.extend({},v.elementsDefaults,o)).name||c;if(v.collections[t])return v.collections[t];var r=u({name:t}),a=[],n={addElement:function(t,n){(n=n||{}).stack=r;var e=l(t,n);return a.push({stickyElement:e,element:t}),e},removeElement:function(t){for(var n,e=a.length;e--;)if(angular.isString(t)&&"#"+a[e].element.id===t||a[e].element===t){n=e;break}var o=a.splice(n,1)[0];return o&&o.stickyElement.destroy(),o},draw:function(t){var n={};if(o.parent){var e=u({name:o.parent});n.offset={top:e.heightCurrent("top"),zIndex:e.length()}}angular.extend(n,t||{}),angular.forEach(a,function(t){t.stickyElement.draw(n)})}};return n.destroy=function(){angular.forEach(angular.copy(a),function(t){n.removeElement(t)}),delete v.collections[t],0<--p||(m.off("resize",h),m.off("scroll",g),s(),d())},n.trackedElements=function(){return a},v.collections[t]=n,1<++p||(h=f(y,v.defaults.checkDelay,{leading:!1}),m.on("resize",h),m.on("scroll",g),s=e.$on("$viewContentLoaded",h),d=e.$on("$includeContentLoaded",h),h()),n}}]};return v}).directive("hlSticky",["$log","$window","$document","hlStickyElementCollection",function(t,n,e,a){return{restrict:"A",scope:{container:"@",anchor:"@",stickyClass:"@",mediaQuery:"@",collection:"@",collectionParent:"@",event:"&",enable:"=",alwaysSticky:"="},link:function(e,t,n){t.addClass("hl-sticky");var o=a({name:e.collection,parent:e.collectionParent}),r={id:n.hlSticky,event:function(t){e.event({event:t})}};angular.forEach(["anchor","container","stickyClass","mediaQuery","enable","alwaysSticky"],function(t){angular.isDefined(e[t])&&(r[t]=e[t])}),angular.forEach(["usePlaceholder","offsetTop","offsetBottom"],function(t){angular.isDefined(n[t])&&(r[t]=e.$parent.$eval(n[t]))}),o.addElement(t,r),e.$watch("enable",function(t,n){t!==n&&(r.enable=e.enable,o.draw({force:!0}))}),e.$watch("alwaysSticky",function(t,n){t!==n&&(r.alwaysSticky=e.alwaysSticky,o.draw({force:!0}))}),e.$on("$destroy",function(){o.removeElement(t),o.trackedElements().length||o.destroy()})}}}]).factory("throttle",["$timeout",function(i){return function(e,o,r){var a=null;return r=r||{},function(){var t=this,n=arguments;a||(!1!==r.leading&&e.apply(t,n),a=i(function(){a=null,!1!==r.trailing&&e.apply(t,n)},o,!1))}}}]);