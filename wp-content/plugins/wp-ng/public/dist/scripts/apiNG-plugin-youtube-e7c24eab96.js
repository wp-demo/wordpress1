"use strict";angular.module("jtt_aping_youtube",["jtt_youtube"]).directive("apingYoutube",["youtubeFactory","apingYoutubeHelper","apingUtilityHelper",function(s,r,d){return{require:"?aping",restrict:"A",replace:"false",link:function(e,t,i,a){var o=a.getAppSettings();d.parseJsonFromAttributes(i.apingYoutube,r.getThisPlatformString(),o).forEach(function(e){var t={model:o.model};void 0!==o.getNativeData?t.getNativeData=o.getNativeData:t.getNativeData=!1;var i={key:d.getApiCredentials(r.getThisPlatformString(),"apiKey")};if(void 0!==e.items?i.maxResults=e.items:i.maxResults=o.items,0===i.maxResults||"0"===i.maxResults)return!1;if((i.maxResults<0||isNaN(i.maxResults))&&(i.maxResults=void 0),50<i.maxResults&&(i.maxResults=50),e.videoId)i.videoId=e.videoId,s.getVideoById(i).then(function(e){e&&a.concatToResults(r.getObjectByJsonData(e,t))});else if(e.channelId){if(i.channelId=e.channelId,e.search&&(i.q=e.search),e.order)if("$RANDOM"===e.order){var n=["date","rating","relevance","title","videoCount","viewCount"];i.order=n[Math.floor(Math.random()*n.length)]}else i.order=e.order;s.getVideosFromChannelById(i).then(function(e){e&&a.concatToResults(r.getObjectByJsonData(e,t))})}else if(e.search||e.lat&&e.lng){if(e.order)if("$RANDOM"===e.order){n=["date","rating","relevance","title","videoCount","viewCount"];i.order=n[Math.floor(Math.random()*n.length)]}else i.order=e.order;e.search&&(i.q=e.search),e.lat&&e.lng&&(i.location=e.lat+","+e.lng),e.distance&&(i.locationRadius=e.distance),s.getVideosFromSearchByParams(i).then(function(e){e&&a.concatToResults(r.getObjectByJsonData(e,t))})}else e.playlistId&&(i.playlistId=e.playlistId,s.getVideosFromPlaylistById(i).then(function(e){e&&a.concatToResults(r.getObjectByJsonData(e,t))}))})}}}]),angular.module("jtt_aping_youtube").service("apingYoutubeHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(i,n,e){this.getThisPlatformString=function(){return"youtube"},this.getThisPlatformLink=function(){return"https://www.youtube.com/"},this.convertYoutubeDurationToSeconds=function(e){var t=e.match(/\d+/g);return 0<=e.indexOf("M")&&-1==e.indexOf("H")&&-1==e.indexOf("S")&&(t=[0,t[0],0]),0<=e.indexOf("H")&&-1==e.indexOf("M")&&(t=[t[0],0,t[1]]),0<=e.indexOf("H")&&-1==e.indexOf("M")&&-1==e.indexOf("S")&&(t=[t[0],0,0]),e=0,3==t.length&&(e+=3600*parseInt(t[0]),e+=60*parseInt(t[1]),e+=parseInt(t[2])),2==t.length&&(e+=60*parseInt(t[0]),e+=parseInt(t[1])),1==t.length&&(e+=parseInt(t[0])),e},this.getYoutubeIdFromUrl=function(e){return e.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/)[1]||!1},this.getYoutubeImageFromId=function(e,t){switch(t){case"default":case"maxresdefault":case"mqdefault":case"sddefault":return"https://img.youtube.com/vi/"+e+"/"+t+".jpg";case"hqdefault":default:return"https://img.youtube.com/vi/"+e+"/hqdefault.jpg"}},this.getObjectByJsonData=function(e,n){var a=[];if(e&&e.data){var o=this;e.data.items&&angular.forEach(e.data.items,function(e,t){var i;(i=!0===n.getNativeData||"true"===n.getNativeData?e:o.getItemByJsonData(e,n.model))&&a.push(i)})}return a},this.getItemByJsonData=function(e,t){var i={};if(e&&t)switch(t){case"social":i=this.getSocialItemByJsonData(e);break;case"video":i=this.getVideoItemByJsonData(e);break;default:return!1}return i},this.getSocialItemByJsonData=function(e){var t=i.getNew("social","youtube");return angular.extend(t,{blog_name:e.snippet.channelTitle||void 0,blog_id:e.snippet.channelId||void 0,blog_link:this.getThisPlatformLink()+"channel/"+e.snippet.channelId,intern_type:e.id.kind,intern_id:e.id.videoId||(e.snippet.resourceId&&e.snippet.resourceId.videoId?e.snippet.resourceId.videoId:e.id),timestamp:n.getTimestampFromDateString(e.snippet.publishedAt,1e3,7200)}),t.date_time=new Date(t.timestamp),""!==e.snippet.title&&""!==e.snippet.description?(t.caption=e.snippet.title,t.text=e.snippet.description):""!==e.snippet.title?t.caption=e.snippet.title:t.caption=e.snippet.description,"youtube#video"==e.id.kind?t.type="video":"youtube#playlistItem"==e.kind&&e.snippet.resourceId&&"youtube#video"==e.snippet.resourceId.kind&&(t.type="video",t.position=e.snippet.position),t.source='<iframe width="1280" height="720" src="https://www.youtube.com/embed/'+t.intern_id+'?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>',t.img_url=this.getYoutubeImageFromId(t.intern_id),t.thumb_url=this.getYoutubeImageFromId(t.intern_id,"default"),t.native_url=this.getYoutubeImageFromId(t.intern_id),t.post_url=this.getThisPlatformLink()+"watch?v="+t.intern_id,e.statistics&&(e.statistics.commentCount&&0<e.statistics.commentCount&&(t.comments=e.statistics.commentCount),e.statistics.likeCount&&0<e.statistics.likeCount&&(t.likes=e.statistics.likeCount)),t},this.getVideoItemByJsonData=function(e){var t=i.getNew("video","youtube");return angular.extend(t,{blog_name:e.snippet.channelTitle||void 0,blog_id:e.snippet.channelId||void 0,blog_link:this.getThisPlatformLink()+"channel/"+e.snippet.channelId,intern_type:e.id.kind,intern_id:e.id.videoId||(e.snippet.resourceId&&e.snippet.resourceId.videoId?e.snippet.resourceId.videoId:e.id),timestamp:n.getTimestampFromDateString(e.snippet.publishedAt,1e3,7200)}),t.date_time=new Date(t.timestamp),""!==e.snippet.title&&""!==e.snippet.description?(t.caption=e.snippet.title,t.text=e.snippet.description):""!==e.snippet.title?t.caption=e.snippet.title:t.caption=e.snippet.description,t.img_url=this.getYoutubeImageFromId(t.intern_id),t.thumb_url=this.getYoutubeImageFromId(t.intern_id,"default"),t.native_url=this.getYoutubeImageFromId(t.intern_id),t.post_url=this.getThisPlatformLink()+"watch?v="+t.intern_id,t.position=e.snippet.position,t.markup='<iframe width="1280" height="720" src="https://www.youtube.com/embed/'+t.intern_id+'?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>',e.statistics&&(e.statistics.commentCount&&0<e.statistics.commentCount&&(t.comments=e.statistics.commentCount),e.statistics.likeCount&&0<e.statistics.likeCount&&(t.likes=e.statistics.likeCount)),e.contentDetails&&e.contentDetails.duration&&(t.duration=this.convertYoutubeDurationToSeconds(e.contentDetails.duration)),t}}]),angular.module("jtt_youtube",[]).factory("youtubeFactory",["$http","youtubeSearchDataService",function(i,n){var e={getVideosFromChannelById:function(e){var t=n.getNew("videosFromChannelById",e);return i({method:"GET",url:t.url,params:t.object})},getVideosFromSearchByParams:function(e){var t=n.getNew("videosFromSearchByParams",e);return i({method:"GET",url:t.url,params:t.object})},getVideosFromPlaylistById:function(e){var t=n.getNew("videosFromPlaylistById",e);return i({method:"GET",url:t.url,params:t.object})},getChannelById:function(e){var t=n.getNew("channelById",e);return i({method:"GET",url:t.url,params:t.object})},getVideoById:function(e){var t=n.getNew("videoById",e);return i({method:"GET",url:t.url,params:t.object})}};return e}]).service("youtubeSearchDataService",function(){this.getApiBaseUrl=function(e){return"https://content.googleapis.com/youtube/v3/"},this.fillDataInObjectByList=function(i,n,e){return angular.forEach(e,function(e,t){void 0!==e&&e.constructor===Array?angular.isDefined(n[e[0]])?i.object[e[0]]=n[e[0]]:i.object[e[0]]=e[1]:angular.isDefined(n[e])&&(i.object[e]=n[e])}),i},this.getNew=function(e,t){var i={object:{key:t.key},url:""};switch(e){case"videosFromChannelById":(i=this.fillDataInObjectByList(i,t,[["part","id,snippet"],["type","video"],["order","date"],["videoEmbeddable",!0],"channelId","q","maxResults","publishedAfter","publishedBefore","regionCode","relevanceLanguage","safeSearch","videoLicense","videoSyndicated","fields"])).url=this.getApiBaseUrl()+"search?",(t.nextPageToken||t.prevPageToken)&&(i.url+="pageToken="+(t.nextPageToken||t.prevPageToken)+"&");break;case"videosFromSearchByParams":i=this.fillDataInObjectByList(i,t,[["part","id,snippet"],["type","video"],["order","date"],["videoEmbeddable",!0],"location","q","maxResults","publishedAfter","publishedBefore","regionCode","relevanceLanguage","safeSearch","videoLicense","videoSyndicated","fields"]),angular.isDefined(t.locationRadius)?i.object.locationRadius=t.locationRadius:angular.isDefined(t.location)&&(i.object.locationRadius="5000m"),i.url=this.getApiBaseUrl()+"search?",(t.nextPageToken||t.prevPageToken)&&(i.url+="pageToken="+(t.nextPageToken||t.prevPageToken)+"&");break;case"videosFromPlaylistById":(i=this.fillDataInObjectByList(i,t,[["part","id,snippet"],["type","video"],"playlistId","maxResults","fields"])).url=this.getApiBaseUrl()+"playlistItems?",(t.nextPageToken||t.prevPageToken)&&(i.url+="pageToken="+(t.nextPageToken||t.prevPageToken)+"&");break;case"videoById":(i=this.fillDataInObjectByList(i,t,[["part","id,snippet,contentDetails,statistics"]])).object.id=t.videoId,i.url=this.getApiBaseUrl()+"videos?",(t.nextPageToken||t.prevPageToken)&&(i.url+="pageToken="+(t.nextPageToken||t.prevPageToken)+"&");break;case"channelById":(i=this.fillDataInObjectByList(i,t,[["part","id,snippet"],["type","channel"]])).url=this.getApiBaseUrl()+"search?",(t.nextPageToken||t.prevPageToken)&&(i.url+="pageToken="+(t.nextPageToken||t.prevPageToken)+"&")}return i}});